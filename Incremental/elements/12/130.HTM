<P style="LINE-HEIGHT: 1.5"><FONT class=extract>In the<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/operators.html"><SPAN class=doc><FONT class=extract color=#0066cc size=3>last chapter</FONT></SPAN></A><FONT class=extract>, we introduced operators, sets, and values, and did some simple computation with them. Now that we have that groundwork done, it&#8217;s time to actually talk about specifications.</FONT></P>
<P id=index-0 style="LINE-HEIGHT: 1.5"><FONT class=extract>TLA+ is the<SPAN>&nbsp;</SPAN><EM>Temporal Logic of Actions</EM>, where the &#8220;actions&#8221; are descriptions of state changes in the system. It&#8217;s a powerful way of expressing mutation, but it is also very general, accepting a large degree of complexity to be able to express more powerful systems. Many engineers struggle to start learning it. So in 2009, Leslie Lamport created a DSL called PlusCal: a more programming-like syntax that compiles to TLA+ actions.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>PlusCal isn&#8217;t as powerful as &#8220;raw&#8221; TLA+, and there are some types of specifications you cannot write in it. But for many other kinds of specifications, it is<SPAN>&nbsp;</SPAN><EM>simpler</EM><SPAN>&nbsp;</SPAN>than doing everything in TLA+, and it is easier to learn. In my experience as an educator, I&#8217;ve found that most programmers have an easier time learning PlusCal and then raw TLA+ than they do if they start with raw TLA+. So the rest of the beginner part of this text will use PlusCal.</FONT></P>
<DIV class="admonition note" style="OVERFLOW: hidden; MARGIN-TOP: 1px; MARGIN-LEFT: 1px; BORDER-LEFT: rgb(88,127,159) 5px solid; MARGIN-RIGHT: 1px; box-shadow: 0px 0px 0px 1px var(--dividerColor); border-radius: 0.2rem">
<P class=admonition-title style="BOX-SIZING: border-box; FONT-WEIGHT: bolder; COLOR: rgb(88,127,159); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>Note</FONT></P>
<P style="BOX-SIZING: border-box; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>If you&#8217;re more mathematically inclined, or already know PlusCal and want to go further, you can skip to the section on<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/tla.html"><SPAN class=doc><FONT class=extract color=#0066cc>learning TLA+</FONT></SPAN></A><FONT class=extract>.</FONT></P></DIV></SECTION><SECTION id=pluscal style="FONT-SIZE: medium; FONT-FAMILY: Roboto, OpenSans, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 4px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(37,38,48); FONT-STYLE: normal; MARGIN-LEFT: 4px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); MARGIN-RIGHT: 4px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">
<H2 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>PlusCal</FONT></H2>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Let&#8217;s start with a very simple spec:</FONT></P>
<DIV id=id9 class="literal-block-wrapper docutils container">
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class="c c-PreProc" style="COLOR: rgb(61,123,123); FONT-STYLE: italic">----</SPAN> <SPAN class="c c-PreProc" style="COLOR: rgb(61,123,123); FONT-STYLE: italic">MODULE</SPAN> <SPAN class="c c-PreProc" style="COLOR: rgb(61,123,123); FONT-STYLE: italic">pluscal</SPAN> <SPAN class="c c-PreProc" style="COLOR: rgb(61,123,123); FONT-STYLE: italic">----</SPAN>
<SPAN class=kn style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">EXTENDS</SPAN> <SPAN class=n>Integers</SPAN><SPAN class=p>,</SPAN> <SPAN class=n>TLC</SPAN>

<SPAN class=nf style="COLOR: rgb(0,0,255)">(* --algorithm pluscal</SPAN>
<SPAN class=n>variables</SPAN>
 <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">2</SPAN><SPAN class=p>;</SPAN>
 <SPAN class=n>y</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN> <SPAN class=bp style="COLOR: rgb(0,128,0)">TRUE</SPAN><SPAN class=p>;</SPAN>

<SPAN class=nf style="COLOR: rgb(0,0,255)">begin</SPAN>
<SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">  A:</SPAN>
    <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
<SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">  B:</SPAN>
    <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
    <SPAN class=n>y</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=bp style="COLOR: rgb(0,128,0)">FALSE</SPAN><SPAN class=p>;</SPAN>
<SPAN class=nf style="COLOR: rgb(0,0,255)">end algorithm; *)</SPAN>
<SPAN class="c c-PreProc" style="COLOR: rgb(61,123,123); FONT-STYLE: italic">====</SPAN>
</FONT></PRE></DIV></DIV>
<DIV class=code-block-caption style="FONT-SIZE: 0.8em; TEXT-ALIGN: center"><SPAN class=caption-text><A class="reference download internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/_downloads/f615300b4162cdeb1883839fcfbf6062/pluscal.tla" download=""><CODE class="xref download docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre><FONT class=extract color=#0066cc size=2>spec</FONT></SPAN></CODE></A></SPAN></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Inside the comment block (<CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>(*</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>*)</SPAN></CODE>) is our PlusCal algorithm. We need to do this because this is a valid TLA+ file; the pluscal algorithm will be compiled to TLA+ below. The algorithm must start with<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>--algorithm</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>$name</SPAN></CODE>, otherwise it will be treated like a regular comment. Unlike the module name, the algorithm<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>$name</SPAN></CODE><SPAN>&nbsp;</SPAN>doesn&#8217;t need to correspond to anything, and can be your root password for all anyone cares.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Next, we have a variables block. Any TLA+ value can be a variable. We open the body of the algorithm with<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>begin</SPAN></CODE><SPAN>&nbsp;</SPAN>and close it with<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>end</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>algorithm</SPAN></CODE>. Inside that we have two<SPAN>&nbsp;</SPAN><EM class=dfn>labels</EM>,<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>A</SPAN></CODE><SPAN>&nbsp;</SPAN>and<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>B</SPAN></CODE>, which we will discuss more in the next section. Inside the labels we have update statements, which use<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>:=</SPAN></CODE>.<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>:=</SPAN></CODE><SPAN>&nbsp;</SPAN>is<SPAN>&nbsp;</SPAN><STRONG>only</STRONG><SPAN>&nbsp;</SPAN>used when we have an existing variable and want to update its value. Otherwise, we use<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>=</SPAN></CODE>.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>We discussed how to translate the pluscal in<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/setup.html"><SPAN class=doc><FONT class=extract color=#0066cc size=3>Setup</FONT></SPAN></A><FONT class=extract>, but as a refresher, we can do this in the menu bar:</FONT></P><FIGURE class=align-default style="DISPLAY: flex; flex-wrap: wrap; justify-content: center"><FONT class=extract><IMG style="MAX-WIDTH: 100%; BORDER-TOP: 1px; BORDER-RIGHT: 1px; BORDER-BOTTOM: 1px; BORDER-LEFT: 1px" alt=../_images/translate_pluscal.png src="https://www.learntla.com/_images/translate_pluscal.png"></FIGURE> </FONT>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Alternatively, we can use<SPAN>&nbsp;</SPAN><KBD class="kbd compound docutils literal notranslate"><KBD class="kbd docutils literal notranslate">cmd</KBD>-<KBD class="kbd docutils literal notranslate">T</KBD></KBD><SPAN>&nbsp;</SPAN>on Mac or<SPAN>&nbsp;</SPAN><KBD class="kbd compound docutils literal notranslate"><KBD class="kbd docutils literal notranslate">ctrl</KBD>-<KBD class="kbd docutils literal notranslate">T</KBD></KBD><SPAN>&nbsp;</SPAN>on Windows and Linux. This puts a translation below the comment block:</FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=c style="COLOR: rgb(61,123,123); FONT-STYLE: italic">\* BEGIN TRANSLATION</SPAN>
<SPAN class=c style="COLOR: rgb(61,123,123); FONT-STYLE: italic">\* \* A bunch of TLA+ code</SPAN>
<SPAN class=c style="COLOR: rgb(61,123,123); FONT-STYLE: italic">\* END TRANSLATION</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>That&#8217;s what&#8217;s actually run when we model check this spec.</FONT></P>
<DIV class="admonition tip" style="OVERFLOW: hidden; MARGIN-TOP: 1px; MARGIN-LEFT: 1px; BORDER-LEFT: rgb(86,183,156) 5px solid; MARGIN-RIGHT: 1px; box-shadow: 0px 0px 0px 1px var(--dividerColor); border-radius: 0.2rem">
<P class=admonition-title style="BOX-SIZING: border-box; FONT-WEIGHT: bolder; COLOR: rgb(86,183,156); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>Tip</FONT></P>
<P style="BOX-SIZING: border-box; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>If you right-click in the spec, there&#8217;s an option at the bottom of the context menu to &#8220;Translate PlusCal Automatically&#8221;. This helps if you keep forgetting to translate, though it raises an error if you&#8217;re writing a<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/tla.html"><SPAN class=doc><FONT class=extract color=#0066cc size=3>pure TLA+ spec</FONT></SPAN></A><FONT class=extract>.</FONT></P></DIV><SECTION id=labels style="MARGIN-TOP: 2px; MARGIN-LEFT: 2px; MARGIN-RIGHT: 2px"><SPAN id=label></SPAN><SPAN id=id1></SPAN>
<H3 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>Labels</FONT></H3>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>We&#8217;re learning TLA+ to work on complex systems, so let&#8217;s frame the motivation and existence of labels in that context. What are we building up to?</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Complex systems have lots of<SPAN>&nbsp;</SPAN><EM>concurrency</EM>, and many things are going on at once. Events aren&#8217;t instantaneous, and may take some time to complete. But they can happen on different timescales. Compare these two steps:</FONT></P>
<OL class="arabic simple" style="LIST-STYLE-TYPE: decimal">
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Summing a list of 100 numbers.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Making an HTTP request and receiving the response.</FONT></P></LI></OL>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>The first line of code takes tens of nanoseconds to run, and the second tens of milliseconds. That&#8217;s a time difference of six orders of magnitude. It might be possible for the summation to happen in between the request and response, but it&#8217;s virtually impossible for the HTTP request to happen in between starting and finishing the summation. In our system, the first event would be &#8220;instantaneous&#8221;, while the second would not.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Which brings us to labels. Labels represent everything that can happen in a single step of the system. If I write</FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">Label1:</SPAN>
  <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>Sum</SPAN><SPAN class=p>(</SPAN><SPAN class=n>seq</SPAN><SPAN class=p>);</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>I am saying that the summation happens in a single step, and no time passes between the start and end of the summation. By contrast, if I write</FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">SendRequest:</SPAN>
  <SPAN class=c style="COLOR: rgb(61,123,123); FONT-STYLE: italic">\* blah blah blah</SPAN>
<SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">GetResponse:</SPAN>
  <SPAN class=c style="COLOR: rgb(61,123,123); FONT-STYLE: italic">\* blah blah blah</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Then<SPAN>&nbsp;</SPAN><EM>time passes</EM><SPAN>&nbsp;</SPAN>between<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>SendRequest</SPAN></CODE><SPAN>&nbsp;</SPAN>and<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>GetResponse</SPAN></CODE>.</FONT></P>
<DIV class="admonition note" style="OVERFLOW: hidden; MARGIN-TOP: 1px; MARGIN-LEFT: 1px; BORDER-LEFT: rgb(88,127,159) 5px solid; MARGIN-RIGHT: 1px; box-shadow: 0px 0px 0px 1px var(--dividerColor); border-radius: 0.2rem">
<P class=admonition-title style="BOX-SIZING: border-box; FONT-WEIGHT: bolder; COLOR: rgb(88,127,159); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>Note</FONT></P>
<P style="BOX-SIZING: border-box; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>The labels represent the titular &#8220;actions&#8221; in the<SPAN>&nbsp;</SPAN><EM>Temporal Logic of Actions</EM>.</FONT></P></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>If I wanted to, I could<SPAN>&nbsp;</SPAN><EM>choose</EM><SPAN>&nbsp;</SPAN>to make the summation nonatomic. Here&#8217;s how I&#8217;d do it in PlusCal:</FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">Sum:</SPAN>
  <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">while</SPAN> <SPAN class=n>i</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">&lt;=</SPAN> <SPAN class=n>Len</SPAN><SPAN class=p>(</SPAN><SPAN class=n>seq</SPAN><SPAN class=p>)</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">do</SPAN>
    <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN> <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=n>i</SPAN><SPAN class=p>];</SPAN>
    <SPAN class=n>i</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>i</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">end</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">while</SPAN><SPAN class=p>;</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>We&#8217;ll talk about the nuances of<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/pluscal.html#while"><SPAN class="std std-ref"><FONT class=extract color=#0066cc size=3>while</FONT></SPAN></A><FONT class=extract><SPAN>&nbsp;</SPAN>later, but the basic idea is that now<SPAN>&nbsp;</SPAN><EM>each iteration</EM><SPAN>&nbsp;</SPAN>of the summation is nonatomic. We could add two numbers, start an http request, add two more, receive the response, and add the rest. Or we could add them all before both steps of the http, or all after. Concurrency is weird.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>The point is this: the labels let us specify just how concurrent our system is. If we want to express that something is atomic, we can do that. If we want it to be interruptable, we can do that too. This is what gives us the flexibility to model systems in a way that actually finds relevant issues.</FONT></P></SECTION><SECTION id=label-rules style="MARGIN-TOP: 2px; MARGIN-LEFT: 2px; MARGIN-RIGHT: 2px">
<H3 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>Label Rules</FONT></H3>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>We&#8217;re modeling time here, so there are restrictions on where we can place the labels. We&#8217;ll recap all of the label rules<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/pluscal.html#label-rules-summary"><SPAN class="std std-ref"><FONT class=extract color=#0066cc size=3>at the end</FONT></SPAN></A><FONT class=extract>.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>First,<SPAN>&nbsp;</SPAN><STRONG>all statements must belong to a label.</STRONG><SPAN>&nbsp;</SPAN>This means, among other things, that you must always start the algorithm with a label.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Second,<SPAN>&nbsp;</SPAN><STRONG>any variable can only be updated once per label.</STRONG><SPAN>&nbsp;</SPAN>Remember, each label only represents one single instant of time. If the variable is updated twice, that means it&#8217;s gone through two separate values in a single instant of time, meaning&#8230; it&#8217;s not an instant of time anymore.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>This poses a problem when updating sequences. This is invalid:</FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">Label:</SPAN>
  <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>]</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>]</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">2</SPAN><SPAN class=p>]</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">2</SPAN><SPAN class=p>]</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">-</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
</FONT></PRE></DIV></DIV>
<P id=id3 style="LINE-HEIGHT: 1.5"><SPAN id=index-1></SPAN><FONT class=extract>Because we&#8217;re updating the<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>seq</SPAN></CODE><SPAN>&nbsp;</SPAN>variable twice in one label. To get around this, PlusCal has the &#8220;simultaneous assignment&#8221; operator<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>||</SPAN></CODE>:</FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">Label:</SPAN>

  <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>]</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>]</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">||</SPAN>
  <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">2</SPAN><SPAN class=p>]</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">2</SPAN><SPAN class=p>]</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">-</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>The rest of the label rules relate to<SPAN>&nbsp;</SPAN><EM>specific</EM><SPAN>&nbsp;</SPAN>constructs in PlusCal, so let&#8217;s go over those constructs now.</FONT></P></SECTION><SECTION id=pluscal-expressions style="MARGIN-TOP: 2px; MARGIN-LEFT: 2px; MARGIN-RIGHT: 2px">
<H3 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>PlusCal expressions</FONT></H3>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>In addition to updates, there are three other statement-level constructs:</FONT></P><SPAN id=goto></SPAN><SPAN id=index-2></SPAN>
<UL id=assert>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>skip</SPAN></CODE>: a noop.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>assert</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>expr</SPAN></CODE>: TLC immediately fails the model check if<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>expr</SPAN></CODE><SPAN>&nbsp;</SPAN>is false. (This breaks the &#8220;everything in the label happens at once&#8221;, as TLC will stop<SPAN>&nbsp;</SPAN><EM>as soon</EM><SPAN>&nbsp;</SPAN>as it finds a failing<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>assert</SPAN></CODE>.) To use<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>assert</SPAN></CODE><SPAN>&nbsp;</SPAN>you need to extend<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>TLC</SPAN></CODE>.</FONT></P>
<DIV class="admonition warning" style="OVERFLOW: hidden; MARGIN-TOP: 1px; MARGIN-LEFT: 1px; BORDER-LEFT: crimson 5px solid; MARGIN-RIGHT: 1px; box-shadow: 0px 0px 0px 1px var(--dividerColor); border-radius: 0.2rem">
<P class=admonition-title style="BOX-SIZING: border-box; FONT-WEIGHT: bolder; COLOR: crimson; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>Warning</FONT></P>
<P style="BOX-SIZING: border-box; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>The error trace will<SPAN>&nbsp;</SPAN><EM>not</EM><SPAN>&nbsp;</SPAN>show the step that triggered the failing assert! For that reason, prefer invariants to asserts.</FONT></P></DIV>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>goto</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>L</SPAN></CODE>: jumps to label<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>L</SPAN></CODE>.<SPAN>&nbsp;</SPAN><STRONG>A label must immediately follow any goto statement</STRONG>.</FONT></P></LI></UL>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Everything else in PlusCal is a block-level construct.</FONT></P><SECTION id=if style="MARGIN-TOP: 1px; MARGIN-LEFT: 1px; MARGIN-RIGHT: 1px"><SPAN id=if-pluscal></SPAN><SPAN id=index-3></SPAN>
<H4 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>if</FONT></H4>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">if</SPAN> <SPAN class=n>Expr</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">then</SPAN>
  <SPAN class=n>skip</SPAN><SPAN class=p>;</SPAN>
<SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">elsif</SPAN> <SPAN class=n>Expr2</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">then</SPAN>
  <SPAN class=n>skip</SPAN><SPAN class=p>;</SPAN>
<SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">else</SPAN>
  <SPAN class=n>skip</SPAN><SPAN class=p>;</SPAN>
<SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">end</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">if</SPAN><SPAN class=p>;</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>You<SPAN>&nbsp;</SPAN><EM>can</EM><SPAN>&nbsp;</SPAN>put labels inside an if block. This is useful if your logic branches, and some of the branches represent more complicated behavior. You don&#8217;t need to balance the labels in an if block&#8212; some conditionals can have labels and others do not.<SPAN>&nbsp;</SPAN><STRONG>However, if any branch has a label, you must follow the entire block with a label</STRONG>. To see why, consider the following:</FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">A:</SPAN>
  <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">if</SPAN> <SPAN class=n>bool</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">then</SPAN>
<SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">    B:</SPAN>
      <SPAN class=n>skip</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">else</SPAN>
    <SPAN class=n>skip</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">end</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">if</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>If<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>bool</SPAN></CODE><SPAN>&nbsp;</SPAN>is true, then<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>x</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>:=</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>1</SPAN></CODE><SPAN>&nbsp;</SPAN>would happen as part of label B. But if<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>bool</SPAN></CODE><SPAN>&nbsp;</SPAN>is false, then it would happen as part of label A. Since statements must<SPAN>&nbsp;</SPAN><EM>unambiguously</EM><SPAN>&nbsp;</SPAN>belong to a single label, this is invalid PlusCal, and we need to add an extra label<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>C</SPAN></CODE>.</FONT></P>
<DIV class="admonition warning" style="OVERFLOW: hidden; MARGIN-TOP: 1px; MARGIN-LEFT: 1px; BORDER-LEFT: crimson 5px solid; MARGIN-RIGHT: 1px; box-shadow: 0px 0px 0px 1px var(--dividerColor); border-radius: 0.2rem">
<P class=admonition-title style="BOX-SIZING: border-box; FONT-WEIGHT: bolder; COLOR: crimson; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>Warning</FONT></P>
<P style="BOX-SIZING: border-box; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>A common misunderstanding I see in beginners is thinking the B label is<SPAN>&nbsp;</SPAN><EM>nested in</EM><SPAN>&nbsp;</SPAN>the A label, like we&#8217;re in both at the same time. This isn&#8217;t how it works: we stop being in the A label as soon as we enter the B label. A better mental model is that since<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>B:</SPAN></CODE><SPAN>&nbsp;</SPAN>is inside a condition from<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>A:</SPAN></CODE>, the B label is only<SPAN>&nbsp;</SPAN><EM>reachable</EM><SPAN>&nbsp;</SPAN>from A.</FONT></P></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Not all blocks have to have the<SPAN>&nbsp;</SPAN><EM>same</EM><SPAN>&nbsp;</SPAN>number of labels! Conditionals trigger different behavior, which can take different amounts of time.</FONT></P></SECTION><SECTION id=macro style="MARGIN-TOP: 1px; MARGIN-LEFT: 1px; MARGIN-RIGHT: 1px"><SPAN id=index-4></SPAN><SPAN id=id5></SPAN>
<H4 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>macro</FONT></H4>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Macros are simple rewrite rules, designed to help clean up repetitive bits of logic. They must be placed above the<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>begin</SPAN></CODE><SPAN>&nbsp;</SPAN>block of the algorithm.<SPAN>&nbsp;</SPAN><STRONG>Macros may not contain labels.</STRONG></FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=nf style="COLOR: rgb(0,0,255)">macro</SPAN> <SPAN class=n>inc</SPAN><SPAN class=p>(</SPAN><SPAN class=n>var</SPAN><SPAN class=p>)</SPAN> <SPAN class=nf style="COLOR: rgb(0,0,255)">begin</SPAN>
  <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">if</SPAN> <SPAN class=n>var</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">&lt;</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">10</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">then</SPAN>
    <SPAN class=n>var</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>var</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">end</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">if</SPAN><SPAN class=p>;</SPAN>
<SPAN class=nf style="COLOR: rgb(0,0,255)">end macro</SPAN><SPAN class=p>;</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Macros count as<SPAN>&nbsp;</SPAN><EM>textual</EM><SPAN>&nbsp;</SPAN>substitutions. If we passed in<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>some_inc(x)</SPAN></CODE><SPAN>&nbsp;</SPAN>then it would increment the<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>x</SPAN></CODE><SPAN>&nbsp;</SPAN>variable.</FONT></P></SECTION><SECTION id=with style="MARGIN-TOP: 1px; MARGIN-LEFT: 1px; MARGIN-RIGHT: 1px"><SPAN id=id6></SPAN>
<H4 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>with</FONT></H4>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>with</SPAN></CODE><SPAN>&nbsp;</SPAN>statements let you create temporary assignments in the middle of a label.</FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">with</SPAN> <SPAN class=n>tmp_x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN> <SPAN class=n>x</SPAN><SPAN class=p>,</SPAN> <SPAN class=n>tmp_y</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN> <SPAN class=n>y</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">do</SPAN>
  <SPAN class=n>y</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>tmp_x</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>tmp_y</SPAN><SPAN class=p>;</SPAN>
<SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">end</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">with</SPAN><SPAN class=p>;</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Inside the<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>with</SPAN></CODE><SPAN>&nbsp;</SPAN>definition, we do the temporary assignments with<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>=</SPAN></CODE>, not<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>:=</SPAN></CODE>. Remember the rule:<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>:=</SPAN></CODE><SPAN>&nbsp;</SPAN>is only used for updating an existing variable.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>As with macros,<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>with</SPAN></CODE><SPAN>&nbsp;</SPAN><STRONG>statements cannot have labels.</STRONG></FONT></P></SECTION><SECTION id=while style="MARGIN-TOP: 1px; MARGIN-LEFT: 1px; MARGIN-RIGHT: 1px"><SPAN id=index-5></SPAN><SPAN id=id7></SPAN>
<H4 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>while</FONT></H4>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>while</SPAN></CODE><SPAN>&nbsp;</SPAN>is the only form of loop we have.<SPAN>&nbsp;</SPAN><STRONG>A while loop must always be preceded with a label.</STRONG></FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">Sum:</SPAN>
  <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">while</SPAN> <SPAN class=n>i</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">&lt;=</SPAN> <SPAN class=n>Len</SPAN><SPAN class=p>(</SPAN><SPAN class=n>seq</SPAN><SPAN class=p>)</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">do</SPAN>
    <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN> <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=n>i</SPAN><SPAN class=p>];</SPAN>
<SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">    Inc:</SPAN>
      <SPAN class=n>i</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>i</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">end</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">while</SPAN><SPAN class=p>;</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract><STRONG>While is nonatomic</STRONG>. After each iteration of the while loop, we&#8217;re back at the<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>Sum</SPAN></CODE><SPAN>&nbsp;</SPAN>label. Other processes can run before the next iteration. This doesn&#8217;t change things for single process algorithms, but it will matter a lot when we start adding in concurrency.</FONT></P></SECTION></SECTION></SECTION><SECTION id=a-duplication-checker style="FONT-SIZE: medium; FONT-FAMILY: Roboto, OpenSans, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 4px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(37,38,48); FONT-STYLE: normal; MARGIN-LEFT: 4px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); MARGIN-RIGHT: 4px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><SPAN id=duplicates></SPAN><SPAN id=index-6></SPAN>
<H2 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>A Duplication Checker</FONT></H2>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Now that we know the basics of PlusCal, let&#8217;s apply it to a small problem. I like to start with simple array algorithms, because we already have the tools to specify them. First we write an operator that expresses the high-level goal of the algorithm, then we write the algorithm, then we verify the algorithm matches the operator.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>For example, if we were writing an algorithm to check if<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>seq</SPAN></CODE><SPAN>&nbsp;</SPAN>has any duplicate elements, the operator might be<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>IsUnique(seq)</SPAN></CODE>, and then the algorithm could work like this:</FONT></P>
<OL class=arabic style="LIST-STYLE-TYPE: decimal">
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Create an empty set<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>seen</SPAN></CODE>, then step through the elements of<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>seq</SPAN></CODE>.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Every time we see a number, we check if it&#8217;s already in<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>seen</SPAN></CODE>.</FONT></P>
<BLOCKQUOTE>
<DIV>
<UL class=simple>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>If it is, we say the list is not unique.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Otherwise, we add the element to<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>seen</SPAN></CODE><SPAN>&nbsp;</SPAN>and continue.</FONT></P></LI></UL></DIV></BLOCKQUOTE>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>If we reach the end and haven&#8217;t seen any duplicate elements, we say the list is unique.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Our decision should match the operator<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>IsUnique(seq)</SPAN></CODE>.</FONT></P></LI></OL>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>In this chapter we&#8217;ll focus on just writing out the spec, parts (2) and (3). In<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/invariants.html"><SPAN class=doc><FONT class=extract color=#0066cc size=3>the next chapter</FONT></SPAN></A><FONT class=extract><SPAN>&nbsp;</SPAN>we&#8217;ll do steps (1) and (4), actually verifying the algorithm.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>I called this spec<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>duplicates</SPAN></CODE>, but the name isn&#8217;t too important for this.</FONT></P>
<DIV id=id10 class="literal-block-wrapper docutils container">
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class="c c-PreProc" style="COLOR: rgb(61,123,123); FONT-STYLE: italic">----</SPAN> <SPAN class="c c-PreProc" style="COLOR: rgb(61,123,123); FONT-STYLE: italic">MODULE</SPAN> <SPAN class="c c-PreProc" style="COLOR: rgb(61,123,123); FONT-STYLE: italic">duplicates</SPAN> <SPAN class="c c-PreProc" style="COLOR: rgb(61,123,123); FONT-STYLE: italic">----</SPAN>
<SPAN class=kn style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">EXTENDS</SPAN> <SPAN class=n>Integers</SPAN><SPAN class=p>,</SPAN> <SPAN class=n>Sequences</SPAN><SPAN class=p>,</SPAN> <SPAN class=n>TLC</SPAN>

<SPAN class=nf style="COLOR: rgb(0,0,255)">(*--algorithm dup</SPAN>
  <SPAN class=n>variable</SPAN> <SPAN class=n>seq</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">&lt;&lt;</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>,</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">2</SPAN><SPAN class=p>,</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">3</SPAN><SPAN class=p>,</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">2</SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">&gt;&gt;</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=n>index</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=n>seen</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN> <SPAN class=n>{}</SPAN><SPAN class=p>;</SPAN>
  <SPAN class=n>is_unique</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN> <SPAN class=bp style="COLOR: rgb(0,128,0)">TRUE</SPAN><SPAN class=p>;</SPAN>

<SPAN class=nf style="COLOR: rgb(0,0,255)">begin</SPAN>
<SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">  Iterate:</SPAN>
    <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">while</SPAN> <SPAN class=n>index</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">&lt;=</SPAN> <SPAN class=n>Len</SPAN><SPAN class=p>(</SPAN><SPAN class=n>seq</SPAN><SPAN class=p>)</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">do</SPAN>
      <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">if</SPAN> <SPAN class=n>seq</SPAN><SPAN class=p>[</SPAN><SPAN class=n>index</SPAN><SPAN class=p>]</SPAN> <SPAN class=s style="COLOR: rgb(186,33,33)">\notin</SPAN> <SPAN class=n>seen</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">then</SPAN>
        <SPAN class=n>seen</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>seen</SPAN> <SPAN class=nb style="COLOR: rgb(0,128,0)">\union</SPAN> <SPAN class=n>{seq</SPAN><SPAN class=p>[</SPAN><SPAN class=n>index</SPAN><SPAN class=p>]</SPAN><SPAN class=n>}</SPAN><SPAN class=p>;</SPAN>
      <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">else</SPAN>
        <SPAN class=n>is_unique</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=bp style="COLOR: rgb(0,128,0)">FALSE</SPAN><SPAN class=p>;</SPAN>
      <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">end</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">if</SPAN><SPAN class=p>;</SPAN>
      <SPAN class=n>index</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>index</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
    <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">end</SPAN> <SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">while</SPAN><SPAN class=p>;</SPAN>
<SPAN class=nf style="COLOR: rgb(0,0,255)">end algorithm; *)</SPAN>
<SPAN class="c c-PreProc" style="COLOR: rgb(61,123,123); FONT-STYLE: italic">====</SPAN>
</FONT></PRE></DIV></DIV>
<DIV class=code-block-caption style="FONT-SIZE: 0.8em; TEXT-ALIGN: center"><SPAN class=caption-text><A class="reference download internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/_downloads/53a13df4b96b3e1932a79ad9184e0eb4/duplicates.tla" download=""><CODE class="xref download docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre><FONT class=extract color=#0066cc size=2>spec</FONT></SPAN></CODE></A></SPAN></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>(I<SPAN>&nbsp;</SPAN><EM>think</EM><SPAN>&nbsp;</SPAN>this is self-explanatory, but I&#8217;ve been doing this so long I have no idea what is or isn&#8217;t explanatory anymore. If enough people say otherwise I&#8217;ll put a fuller description here.)</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>If you<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/setup.html#running-models"><SPAN class="std std-ref"><FONT class=extract color=#0066cc size=3>run it</FONT></SPAN></A><FONT class=extract>, you will see a page like this:</FONT></P><FIGURE id=id11 class=align-default style="DISPLAY: flex; flex-wrap: wrap; justify-content: center"><A class="reference internal image-reference" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/_images/pluscal_run.png"><FONT class=extract><IMG style="MAX-WIDTH: 100%; BORDER-TOP: 1px; HEIGHT: 176px; BORDER-RIGHT: 1px; WIDTH: 768px; BORDER-BOTTOM: 1px; BORDER-LEFT: 1px" alt=../_images/pluscal_run.png src="https://www.learntla.com/_images/pluscal_run.png"></FONT></A><FIGCAPTION><FONT class=extract> </FONT>
<P style="LINE-HEIGHT: 1.5"><SPAN class=caption-text style="FONT-SIZE: 0.8em; MARGIN-TOP: 8px; TEXT-ALIGN: center"><FONT class=extract>(Click to zoom in)</FONT></SPAN></P></FIGCAPTION></FIGURE>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>I know this completed successfully because otherwise a big error bar would have appeared on the right-hand side. Everything on this page is statistics to help you understand the run better:</FONT></P>
<OL class="arabic simple" style="LIST-STYLE-TYPE: decimal">
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Since complicated models can take a long time to check, the &#8220;state space progress&#8221; tab updates roughly once a minute.</FONT></P></LI></OL>
<OL id=index-7 class="arabic simple" style="LIST-STYLE-TYPE: decimal" start=2>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Diameter is the length of the longest behavior. If TLC found a thousand behaviors with length 2 and one with length 20, the diameter will be reported as 20.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>States found is how many system states the model checker has explored. This includes duplicate states the checker found in different paths.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>The number of<SPAN>&nbsp;</SPAN><EM>unique</EM><SPAN>&nbsp;</SPAN>states found.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>How many states TLC knows<SPAN>&nbsp;</SPAN><EM>for certain</EM><SPAN>&nbsp;</SPAN>it&#8217;ll have to check. Some of these states will add more states to check, and so on and so forth.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>TLC stores explored states as hashes, this is the chance that there&#8217;s a hash collision. In practice this never goes above one in a million billion and can be ignored.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>How often each label was run and how many states that lead to. If one label has 0 states then there&#8217;s probably a bug in your spec.</FONT></P></LI></OL><FIGURE id=id12 class=align-default style="DISPLAY: flex; flex-wrap: wrap; justify-content: center">
<DIV class=graphviz style="DISPLAY: flex; justify-content: center"><FONT class=extract><IMG  src="" class=graphviz style="MAX-WIDTH: 100%; BORDER-TOP: 0px; BORDER-RIGHT: 0px; BORDER-BOTTOM: 0px; BORDER-LEFT: 0px" alt='digraph duplicates_1 {&#10;edge[arrowhead=vee];&#10;&#10;I1 [label="i=1\nseq[i]=1"];&#10;I2 [label="i=2\nseq[i]=2"];&#10;I3 [label="i=3\nseq[i]=3"];&#10;I4 [label="i=4\nseq[i]=4"];&#10;&#10;I1 -> I2 -> I3 -> I4;&#10;}' src="C:\SuperMemo\systems\Incremental\elements\12\"></FONT></DIV><FIGCAPTION>
<P style="LINE-HEIGHT: 1.5"><SPAN class=caption-text style="FONT-SIZE: 0.8em; MARGIN-TOP: 8px; TEXT-ALIGN: center"><FONT class=extract>Four iterate loops, plus Initial and Done states, makes 6 distinct states.</FONT></SPAN></P></FIGCAPTION></FIGURE>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>To make sure that you&#8217;re following properly, you can check that that you got the same number of states and distinct states I did. In my case, I got<SPAN>&nbsp;</SPAN><SPAN>7 states / 6 distinct</SPAN>; you should see that too. If you get a different number, you may have made a mistake in transcribing the spec. The states and distinct states make a partial &#8220;fingerprint&#8221; of the model. Going forward, whenever I show a spec, I&#8217;ll list the states and distinct states of the model check under the code listing.</FONT></P>
<DIV class="admonition note" style="OVERFLOW: hidden; MARGIN-TOP: 1px; MARGIN-LEFT: 1px; BORDER-LEFT: rgb(88,127,159) 5px solid; MARGIN-RIGHT: 1px; box-shadow: 0px 0px 0px 1px var(--dividerColor); border-radius: 0.2rem">
<P class=admonition-title style="BOX-SIZING: border-box; FONT-WEIGHT: bolder; COLOR: rgb(88,127,159); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>Note</FONT></P>
<P style="BOX-SIZING: border-box; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>You&#8217;ll get a different number than me if the spec<SPAN>&nbsp;</SPAN><EM>fails</EM>, because TLC will terminate execution early. In that case, I will note that the modelcheck should fail when showing the code listing.</FONT></P></DIV><SPAN id=multiple-starting-states class=target></SPAN><SECTION id=testing-more-inputs style="MARGIN-TOP: 2px; MARGIN-LEFT: 2px; MARGIN-RIGHT: 2px"><SPAN id=index-8></SPAN>
<H3 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>Testing More Inputs</FONT></H3>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>We now have a basic implementation of our duplication checker. When we run it, though, we want to make sure it&#8217;s working properly for both unique and non-unique sequences. Right now we&#8217;ve only hardcoded a single sequence, so we can only check one of the two cases.</FONT></P>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>To check both, we can use multiple starting states. TLA+ doesn&#8217;t just let us assign values to variables, it also lets us say a variable starts out as<SPAN>&nbsp;</SPAN><EM>some</EM><SPAN>&nbsp;</SPAN>element in a set. It looks like this:</FONT></P>
<DIV id=id13 class="literal-block-wrapper docutils container">
<DIV class="highlight-udiff notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>EXTENDS Integers, Sequences, TLC<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>(*--algorithm dup<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=gd style="COLOR: rgb(160,0,0)">-  variable seq = &lt;&lt;1, 2, 3, 2&gt;&gt;;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=gi style="COLOR: rgb(0,132,0)">+  variable seq \in {&lt;&lt;1, 2, 3, 2&gt;&gt;, &lt;&lt;1, 2, 3, 4&gt;&gt;};</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>  index = 1;<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>  seen = {};<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>  is_unique = TRUE;<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
</FONT></PRE></DIV></DIV>
<DIV class=code-block-caption style="FONT-SIZE: 0.8em; TEXT-ALIGN: center"><SPAN class=caption-text><A class="reference download internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/_downloads/5655c7a2c37c9d85f5107fd2f1e8c096/duplicates.tla" download=""><CODE class="xref download docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre><FONT class=extract color=#0066cc size=2>spec</FONT></SPAN></CODE></A></SPAN></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>The model checker will now check<SPAN>&nbsp;</SPAN><EM>both</EM><SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>&lt;&lt;1,</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>2,</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>3,</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>2&gt;&gt;</SPAN></CODE><SPAN>&nbsp;</SPAN>and<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>&lt;1,</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>2,</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>3,</SPAN><SPAN>&nbsp;</SPAN><SPAN class=pre>4&gt;&gt;</SPAN></CODE><SPAN>&nbsp;</SPAN>as the value of<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>seq</SPAN></CODE>. More specifically, does two complete runs, one for each possible value. If either complete run, or<SPAN>&nbsp;</SPAN><EM class=dfn>behavior</EM>, would lead to an error, TLC will let us know.</FONT></P><FIGURE id=id14 class=align-default style="DISPLAY: flex; flex-wrap: wrap; justify-content: center"><FONT class=extract><IMG style="MAX-WIDTH: 100%; BORDER-TOP: 1px; BORDER-RIGHT: 1px; BORDER-BOTTOM: 1px; BORDER-LEFT: 1px" alt=../_images/duplicates_2.gv.png src="https://www.learntla.com/_images/duplicates_2.gv.png"><FIGCAPTION> </FONT>
<P style="LINE-HEIGHT: 1.5"><SPAN class=caption-text style="FONT-SIZE: 0.8em; MARGIN-TOP: 8px; TEXT-ALIGN: center"><FONT class=extract>There are two possible starting states, each with its own behavior.</FONT></SPAN></P></FIGCAPTION></FIGURE>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Adding multiple starting states increases the complexity of our model. If, in a spec, TLC will normally have to check 10 states, adding 100 initial states could increase the state space to a maximum of 1,000. In practice, it will often be lower, because sometimes initial states will converge:</FONT></P>
<DIV class="highlight-tla notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=n>variables</SPAN> <SPAN class=n>x</SPAN> <SPAN class=s style="COLOR: rgb(186,33,33)">\in</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">..</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">1000</SPAN><SPAN class=p>;</SPAN>
<SPAN class=nf style="COLOR: rgb(0,0,255)">begin</SPAN>
<SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">  A:</SPAN>
    <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=m style="COLOR: rgb(102,102,102)">0</SPAN><SPAN class=p>;</SPAN>
<SPAN class=nt style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">  B:</SPAN>
    <SPAN class=n>x</SPAN> <SPAN class=o style="COLOR: rgb(102,102,102)">:=</SPAN> <SPAN class=n>x</SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN><SPAN class=m style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>;</SPAN>
<SPAN class=nf style="COLOR: rgb(0,0,255)">end algorithm;</SPAN>
</FONT></PRE></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>We might think, with 1000 initial states and 2 labels, there will be 3,000 total states. In practice, the first label &#8220;collapses&#8221; the state space. So the number of<SPAN>&nbsp;</SPAN><EM>distinct</EM><SPAN>&nbsp;</SPAN>states will be far smaller.</FONT></P></SECTION><SECTION id=starting-states style="MARGIN-TOP: 2px; MARGIN-LEFT: 2px; MARGIN-RIGHT: 2px">
<H3 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>10,000 starting states</FONT></H3>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>So now we&#8217;re testing two inputs. That&#8217;s twice as good as one input. Even better than that would be testing 10,000 inputs. Remember how in the last chapter we talked about generating<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/operators.html#sets-of-values"><SPAN class="std std-ref"><FONT class=extract color=#0066cc size=3>sets of values</FONT></SPAN></A><FONT class=extract>? This is just one of the many places it&#8217;s really useful.</FONT></P>
<DIV id=id15 class="literal-block-wrapper docutils container">
<DIV class="highlight-udiff notranslate" style="OVERFLOW-X: auto">
<DIV class=highlight style="BOX-SIZING: border-box; BACKGROUND: rgb(248,248,248); MARGIN-TOP: 0px; OVERFLOW-X: auto; COLOR: rgb(37,38,48); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN-LEFT: 0px; PADDING-RIGHT: 0px; MARGIN-RIGHT: 0px; border-radius: 0.2rem"><PRE style='FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; LINE-HEIGHT: 18px'><SPAN></SPAN><FONT class=extract><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>---- MODULE duplicates ----<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>EXTENDS Integers, Sequences, TLC<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>
<SPAN class=gi style="COLOR: rgb(0,132,0)">+S == 1..10</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=gi style="COLOR: rgb(0,132,0)">+</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>(*--algorithm dup<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=gd style="COLOR: rgb(160,0,0)">-  variable seq = &lt;&lt;1, 2, 3, 2&gt;&gt;;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=gi style="COLOR: rgb(0,132,0)">+  variable seq \in S \X S \X S \X S;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>  index = 1;<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>  seen = {};<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
<SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>  is_unique = TRUE;<SPAN class=w style="COLOR: rgb(187,187,187)"></SPAN>
</FONT></PRE></DIV></DIV>
<DIV class=code-block-caption style="FONT-SIZE: 0.8em; TEXT-ALIGN: center"><SPAN class=caption-text><FONT class=extract><SPAN>70000 states / 60000 distinct</SPAN><SPAN>&nbsp;</SPAN></FONT><A class="reference download internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/_downloads/141ebf7bccb611071d2a3d925dbabd13/duplicates.tla" download=""><CODE class="xref download docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre><FONT class=extract color=#0066cc size=2>spec</FONT></SPAN></CODE></A></SPAN></DIV></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>We&#8217;re now significantly more likely to cover all interesting edge cases. This isn&#8217;t<SPAN>&nbsp;</SPAN><EM>guaranteed</EM>: maybe there&#8217;s a bug that<SPAN>&nbsp;</SPAN><EM>only</EM><SPAN>&nbsp;</SPAN>triggers if we have<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>-187</SPAN></CODE><SPAN>&nbsp;</SPAN>in there somewhere. TLA+ can only augment your engineering judgement, not replace it. But my judgement is telling me that it&#8217;s unlikely for<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>-187</SPAN></CODE><SPAN>&nbsp;</SPAN>to be the edge case, so I&#8217;m confident calling this good coverage.</FONT></P>
<DIV class="admonition note" style="OVERFLOW: hidden; MARGIN-TOP: 1px; MARGIN-LEFT: 1px; BORDER-LEFT: rgb(88,127,159) 5px solid; MARGIN-RIGHT: 1px; box-shadow: 0px 0px 0px 1px var(--dividerColor); border-radius: 0.2rem">
<P class=admonition-title style="BOX-SIZING: border-box; FONT-WEIGHT: bolder; COLOR: rgb(88,127,159); PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>Note</FONT></P>
<P style="BOX-SIZING: border-box; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; LINE-HEIGHT: 1.5; PADDING-RIGHT: 0px"><FONT class=extract>Okay, there&#8217;s one big gap: while we&#8217;re trying a lot of different elements, we&#8217;re only looking at one fixed<SPAN>&nbsp;</SPAN><EM>length</EM>. Maybe there&#8217;s an issue with 1 or 0-length sequences. We&#8217;ll be able to fix this once we learn about<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/functions.html#function-set"><SPAN class="std std-ref"><FONT class=extract color=#0066cc>function sets</FONT></SPAN></A><FONT class=extract>.</FONT></P></DIV>
<P style="LINE-HEIGHT: 1.5"><FONT class=extract>Now that we have broad state-space coverage, it&#8217;s time to write some properties. In<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/invariants.html"><SPAN class=doc><FONT class=extract color=#0066cc size=3>the next chapter</FONT></SPAN></A><FONT class=extract><SPAN>&nbsp;</SPAN>we&#8217;ll specify that our checker always gets the correct result.</FONT></P></SECTION></SECTION><SECTION id=summary style="FONT-SIZE: medium; FONT-FAMILY: Roboto, OpenSans, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 4px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(37,38,48); FONT-STYLE: normal; MARGIN-LEFT: 4px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); MARGIN-RIGHT: 4px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">
<H2 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>Summary</FONT></H2>
<UL class=simple>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Specifications have variables. These can either be a fixed value (using<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>=</SPAN></CODE>) or an element in a set (using<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>\in</SPAN></CODE>). Any TLC value can be a variable.</FONT></P>
<UL>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>If an element of a set, then TLC will test the model on<SPAN>&nbsp;</SPAN><EM>every possible starting state</EM>.</FONT></P></LI></UL>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>PlusCal is a language that makes writing specifications easier.</FONT></P>
<UL>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>In the PlusCal algorithm body, variables are updated with<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>:=</SPAN></CODE>.<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>=</SPAN></CODE><SPAN>&nbsp;</SPAN>is comparison.</FONT></P></LI></UL>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>PlusCal specs are broken up into<SPAN>&nbsp;</SPAN><EM>labels</EM>, units of computations that happen atomically. Everything in the label happens<SPAN>&nbsp;</SPAN><EM>at once</EM>. Labels have restrictions on where they can be placed.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Macros are the primary unit of spec deduplication.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>PlusCal has several block constructs, including<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>with</SPAN></CODE>,<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>if</SPAN></CODE>, and<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>while</SPAN></CODE>.</FONT></P>
<UL>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>with</SPAN></CODE><SPAN>&nbsp;</SPAN>creates temporary identifiers in a block.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>while</SPAN></CODE><SPAN>&nbsp;</SPAN>statements are nonatomic: every loop happens in a separate step.</FONT></P></LI></UL></LI></UL><SECTION id=summary-of-label-rules style="MARGIN-TOP: 2px; MARGIN-LEFT: 2px; MARGIN-RIGHT: 2px"><SPAN id=label-rules-summary></SPAN>
<H3 style="BORDER-TOP-COLOR: gray; MARGIN-TOP: 1px; BORDER-BOTTOM: gray thin solid; FONT-WEIGHT: 100; PADDING-LEFT: 0.3em; MARGIN-LEFT: 1px; BORDER-LEFT: gray thin solid; DISPLAY: inline-block; BORDER-RIGHT-COLOR: gray; MARGIN-RIGHT: 1px"><FONT class=extract>Summary of Label Rules</FONT></H3>
<UL class=simple>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>All algorithms must begin with a label.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>While statements must begin with a label.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Each variable can only be updated once in a label. (You can assign to multiple parts of a sequence with<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/pluscal.html#id3"><SPAN class="std std-ref"><FONT class=extract color=#0066cc size=3>||</FONT></SPAN></A><FONT class=extract>.)</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>Macros and<SPAN>&nbsp;</SPAN><CODE class="docutils literal notranslate" style='FONT-SIZE: 0.9em; FONT-FAMILY: "Roboto Mono", monospace, Monaco, Consolas, "Andale Mono"; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; border-radius: 0.2rem'><SPAN class=pre>with</SPAN></CODE><SPAN>&nbsp;</SPAN>statements cannot contain labels.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>A<SPAN>&nbsp;</SPAN></FONT><A class="reference internal" style="TEXT-DECORATION: none; COLOR: " href="https://www.learntla.com/core/pluscal.html#goto"><SPAN class="std std-ref"><FONT class=extract color=#0066cc size=3>goto</FONT></SPAN></A><FONT class=extract><SPAN>&nbsp;</SPAN>must be followed by a new label.</FONT></P>
<LI style="LINE-HEIGHT: 1.5">
<P style="MARGIN: 0px; LINE-HEIGHT: 1.5"><FONT class=extract>If a branch in a block contains a label inside it, the end of the block must be followed with a label.</FONT></P></LI></UL></SECTION></SECTION>