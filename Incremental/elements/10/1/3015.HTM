<b> : </b><SPAN role=heading aria-level=2 class=devsite-heading>Lifetime of a message</SPAN></H2>
<P>When an app server posts a message to <SPAN class=notranslate>FCM</SPAN> and receives a message ID back, it does not mean that the message was already delivered to the device. Rather, it means that it was accepted for delivery. What happens to the message after it is accepted depends on many factors.</P>
<P>In the best-case scenario, if the device is connected to <SPAN class=notranslate>FCM</SPAN>, the screen is on and there are no throttling restrictions, the message is delivered right away.</P>
<P>If the device is connected but in Doze, a low priority message is stored by <SPAN class=notranslate>FCM</SPAN> until the device is out of Doze. And that's where the <CODE dir=ltr translate="no">collapse_key</CODE> flag plays a role: if there is already a message with the same collapse key (and registration token) stored and waiting for delivery, the old message is discarded and the new message takes its place (that is, the old message is collapsed by the new one). However, if the collapse key is not set, both the new and old messages are stored for future delivery. </P>
<P>If the device is not connected to <SPAN class=notranslate>FCM</SPAN>, the message is stored until a connection is established (again respecting the collapse key rules). When a connection is established, <SPAN class=notranslate>FCM</SPAN> delivers all pending messages to the device. If the device never gets connected again (for instance, if it was factory reset), the message eventually times out and is discarded from <SPAN class=notranslate>FCM</SPAN> storage. The default timeout is four weeks, unless the <CODE dir=ltr translate="no">time_to_live</CODE> flag is set.</P>
<P>To get more insight into the delivery of a message: </P>
<UL>
<P>To get more insight into the delivery of messages on Android or Apple platforms, see the <A href="https://console.firebase.google.com/project/_/notification/reporting"><SPAN class=notranslate>FCM</SPAN> reporting dashboard</A>, which records the number of messages sent and opened on Apple and Android devices, along with data for "impressions" (notifications seen by users) for Android apps. </P></UL>
<P></P>
<P>For Android devices with direct channel messaging enabled, if the device has not connected to <SPAN class=notranslate>FCM</SPAN> for more than one month, <SPAN class=notranslate>FCM</SPAN> still accepts the message but immediately discards it. If the device connects within four weeks of the last data message you sent to it, your client receives the <A href="https://firebase.google.com/docs/reference/android/com/google/firebase/messaging/FirebaseMessagingService#onDeletedMessages()">onDeletedMessages()</A> callback. The app can then handle the situation properly, typically by requesting a full sync from the app server.</P>
<P>Finally, when <SPAN class=notranslate>FCM</SPAN> attempts to deliver a message to the device and the app was uninstalled, <SPAN class=notranslate>FCM</SPAN> discards that message right away and invalidates the registration token. Future attempts to send a message to that device results in a <CODE dir=ltr translate="no">NotRegistered</CODE> error.