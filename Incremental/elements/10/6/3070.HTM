<b> : </b>Creating a CloudFront distribution in front of API Gateway</H2>
<P>These simple steps should help you to create a CloudFront distribution in front of API Gateway.</P>
<P>When you create a CloudFront distribution, it&#8217;s recommended that you block access to API Gateway for anything other than CloudFront distribution. You can do this by following this manual: <A href="https://wellarchitectedlabs.com/security/300_labs/300_multilayered_api_security_with_cognito_and_waf/3_prevent_requests_from_accessing_api_directly/" target=_blank>Prevent requests from accessing API directly</A>.</P>
<P>1. Log in to the <A href="https://console.aws.amazon.com/cloudfront?p=cft&amp;cp=bn&amp;ad=c">CloudFront console</A>.<BR>2. If you already have a CloudFront distribution that you want to use, you can create a new <A href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/distribution-web-values-specify.html#DownloadDistValuesCacheBehavior" target=_blank>caching behavior</A> setting. But we will start with creating a new distribution.<BR></P>
<P style="TEXT-ALIGN: center"><IMG alt="Cloudfront and API Gateway manual 1" src="https://d1tcczg8b21j1t.cloudfront.net/strapi-assets/api_gateway_and_cloudfront_manual_1_2c9a8c9c4b.png" width="65%"></P>
<P>3. For the <STRONG>&#8220;Origin domain&#8221;,</STRONG> add the API gateway link and choose <STRONG>&#8220;HTTPS only&#8221;</STRONG> as the <STRONG>&#8220;Protocol&#8221;</STRONG>. API Gateway doesn't support unencrypted HTTP.<BR></P>
<P style="TEXT-ALIGN: center"><IMG alt="Cloudfront and API Gateway manual 2" src="https://d1tcczg8b21j1t.cloudfront.net/strapi-assets/api_gateway_and_cloudfront_manual_2_dc056c990e.png" width="90%"></P>
<P>4. For <STRONG>&#8220;Viewer protocol policy&#8221;,</STRONG> select <STRONG>&#8220;Redirect HTTP to HTTPS&#8221;</STRONG> and choose <STRONG>&#8220;Get, Head, Options, Put, Post, Patch, Delete&#8221;</STRONG> for <STRONG>&#8220;Allowed HTTP methods&#8221;</STRONG>.<BR></P>
<P style="TEXT-ALIGN: center"><IMG alt="Cloudfront and API Gateway manual 2" src="https://d1tcczg8b21j1t.cloudfront.net/strapi-assets/api_gateway_and_cloudfront_manual_3_2ffb7fc9c3.png" width="70%"></P>
<P>5. In Cache key and origin requests select <STRONG>&#8220;Legacy cache settings&#8221;</STRONG> and:<BR></P>
<P style="MARGIN-LEFT: 15px">a. <STRONG>Headers: None</STRONG>. You can also choose &#8220;Include the following headers&#8221; and select what headers you need to forward to API Gateway. However, there is a problem with the Host header that causes a 403 forbidden error, so do not choose this header or option &#8220;All&#8221;, as it will not work.<BR>b. <STRONG>Query strings: All</STRONG><BR>c. <STRONG>Cookies: All</STRONG><BR></P>
<P style="TEXT-ALIGN: center"><IMG alt="Cloudfront and API Gateway manual 2" src="https://d1tcczg8b21j1t.cloudfront.net/strapi-assets/api_gateway_and_cloudfront_manual_4_baf2bafea2.png" width="90%"></P>
<P>6. Select <STRONG>Response headers policy: Simple CORS.</STRONG><BR></P>
<P style="TEXT-ALIGN: center"><IMG alt="Cloudfront and API Gateway manual 2" src="https://d1tcczg8b21j1t.cloudfront.net/strapi-assets/api_gateway_and_cloudfront_manual_5_c5883a94ca.png" width="90%"></P>
<P>7. You can leave everything else on default or set what you need and click on <STRONG>&#8220;Create distribution&#8221;</STRONG>.<BR>8. Your CloudFront distribution should be ready to use after couple of minutes. For example, you can proceed to add the cloudfront domain to <A href="https://www.stormit.cloud/blog/amazon-route-53/" target=_blank>Route 53 DNS</A>.