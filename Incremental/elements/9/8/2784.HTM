<H2 id=the_problem class=tocHeading style='BOX-SIZING: border-box; FONT-SIZE: 26px; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 500; COLOR: rgb(26,26,26); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 30px; PADDING-LEFT: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>The problem</FONT></H2>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>Failures in which the application doesn&#8217;t get a response from the database within the expected time frame, such as a temporary network disruption, can result in an amplification of the load imposed on the entire system. Factors contributing to this load amplification include the increased time network connections remain open waiting on a response, the overhead of churning connections that timeout, application retry policies, and back-pressure queueing mechanisms.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>When applications perform high volumes of concurrent database operations at scale, this load amplification can be significantly greater than during steady-state. In extreme cases, this type of scenario can manifest as a<SPAN>&nbsp;</SPAN></FONT><A style='BOX-SIZING: border-box; CURSOR: pointer; TEXT-DECORATION: none; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; BORDER-BOTTOM: rgb(0,122,171) 1px solid; COLOR: ' href="https://sigops.org/s/conferences/hotos/2021/papers/hotos21-s11-bronson.pdf"><FONT class=extract>metastable failure</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>where the load amplification becomes a sustaining feedback loop that results in the failed state persisting even when the original trigger of the failure state (network disruption) has been resolved.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>As a simple example, consider a typical HTTP-based API in which an HTTP request to the application results in a single database read. This is illustrated in the sequence diagram below:</FONT></P><FIGURE class=_figure_abn6g_1 style='BOX-SIZING: border-box; FONT-SIZE: medium; FONT-FAMILY: "Neue Helvetica Now Pro", system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); OUTLINE-WIDTH: 1px; FONT-STYLE: normal; OUTLINE-STYLE: solid; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 20px; DISPLAY: flex; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; flex-direction: column'><FONT class=extract><IMG class="_image_espsy_21 _img_abn6g_17" style="BOX-SIZING: border-box; MARGIN-BOTTOM: 0px; CURSOR: pointer; MAX-WIDTH: 100%; HEIGHT: auto" alt=circuit-breaker-pattern-http-response src="https://images.ctfassets.net/drk57q8lctrm/5PLRLvJUt7qeXEow4fXtnv/52b6fab645bdf74d96fe4296becf93d7/circuit-breaker-pattern-http-response.webp" width=1920 height=684 data-id="5PLRLvJUt7qeXEow4fXtnv"><FIGCAPTION class=_figcaption_abn6g_8 style="BOX-SIZING: border-box; COLOR: ; PADDING-BOTTOM: 0.5em; FONT-STYLE: italic; TEXT-ALIGN: right; PADDING-TOP: 0.8em; PADDING-LEFT: 0.8em; PADDING-RIGHT: 0.8em">A diagram with six boxes, three above and three below with arrows going right and left throughout.</FIGCAPTION></FIGURE> </FONT>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>The system load created from this steady-state usage pattern is often what the system is designed to be able to sustain.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>But now consider what happens when there is a network failure that results in the application timing out database operations. Since the application doesn&#8217;t know the nature of the network timeout, it might also close the TCP connection and open a new one (connection churn). Churning connections can be expensive&#8211;especially when connecting must do a<SPAN>&nbsp;</SPAN></FONT><A style='BOX-SIZING: border-box; CURSOR: pointer; TEXT-DECORATION: none; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; BORDER-BOTTOM: rgb(0,122,171) 1px solid; COLOR: ' href="https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_handshake"><FONT class=extract>TLS handshake</FONT></A><FONT class=extract>. Database applications designed for high availability often retry read operations against replicas (Aerospike does by default), which, during this type of failure, could also timeout and churn another connection per retry.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>This is illustrated in the sequence diagram below:</FONT></P><FIGURE class=_figure_abn6g_1 style='BOX-SIZING: border-box; FONT-SIZE: medium; FONT-FAMILY: "Neue Helvetica Now Pro", system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); OUTLINE-WIDTH: 1px; FONT-STYLE: normal; OUTLINE-STYLE: solid; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 20px; DISPLAY: flex; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; flex-direction: column'><FONT class=extract><IMG class="_image_espsy_21 _img_abn6g_17" style="BOX-SIZING: border-box; MARGIN-BOTTOM: 0px; CURSOR: pointer; MAX-WIDTH: 100%; HEIGHT: auto" alt=circuit-breaker-pattern-http-client-db-node src="https://images.ctfassets.net/drk57q8lctrm/3ZZ9ZQm6y1ddjHNR0kqWMR/bbcb6c8c1b7c8eb4b61ddbd82f012ba4/circuit-breaker-pattern-http-client-db-node.webp" width=1920 height=1121 data-id="3ZZ9ZQm6y1ddjHNR0kqWMR"><FIGCAPTION class=_figcaption_abn6g_8 style="BOX-SIZING: border-box; COLOR: ; PADDING-BOTTOM: 0.5em; FONT-STYLE: italic; TEXT-ALIGN: right; PADDING-TOP: 0.8em; PADDING-LEFT: 0.8em; PADDING-RIGHT: 0.8em">A technical diagram with four boxes above and below with many arrows going side to side.</FIGCAPTION></FIGURE> </FONT>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>Each attempted transaction is now consuming significantly more time and resources than it would during steady state. This is &#8220;load amplification&#8221; triggered by the network outage.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>Now imagine hundreds or thousands of concurrent application threads performing hundreds, thousands, or millions of database operations per second. The cost of churning a connection adds up at scale. A network outage lasting mere seconds can trigger a metastable failure that lasts far beyond the trigger event, and the only way to recover is to reduce the load on the system. Simply scaling the system to handle the worst-case load amplification wouldn&#8217;t be practical or cost-effective.</FONT></P>
<H2 id=the_circuit_breaker_solution class=tocHeading style='BOX-SIZING: border-box; FONT-SIZE: 26px; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 500; COLOR: rgb(26,26,26); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 30px; PADDING-LEFT: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>The circuit breaker solution</FONT></H2>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>Much like its namesake component in electrical systems, the Circuit Breaker pattern will &#8220;trip the breaker&#8221; when the number of failures in a given time period exceeds a predefined threshold. The idea is to put a hard limit on the impact of these types of failures&#8211;to break the feedback loop&#8211;and recover quickly and automatically once the underlying trigger is resolved.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>The Aerospike implementation of the Circuit Breaker pattern, which is built into the Aerospike client libraries and enabled by default, will trip when there are 100 or more errors within an approximate 1-second window. Both the threshold and the time window are configurable.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>As a simplified example, assume an application is performing 1,000 database read operations per second and a network failure occurs that lasts for 2 seconds. During each of those seconds, when the network is failing, the application would get 1,000 network errors and thus would result in 1,000 churned connections.</FONT></P><FIGURE class=_figure_abn6g_1 style='BOX-SIZING: border-box; FONT-SIZE: medium; FONT-FAMILY: "Neue Helvetica Now Pro", system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); OUTLINE-WIDTH: 1px; FONT-STYLE: normal; OUTLINE-STYLE: solid; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 20px; DISPLAY: flex; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; flex-direction: column'><FONT class=extract><IMG class="_image_espsy_21 _img_abn6g_17" style="BOX-SIZING: border-box; MARGIN-BOTTOM: 0px; CURSOR: pointer; MAX-WIDTH: 100%; HEIGHT: auto" alt=circuit-breaker-pattern-network-failure src="https://images.ctfassets.net/drk57q8lctrm/1w8BiTSRyXJaMn3bcMV9hH/a997da56ae78f90853b9a6c4d51769ae/circuit-breaker-pattern-network-failure.webp" width=1920 height=629 data-id="1w8BiTSRyXJaMn3bcMV9hH"><FIGCAPTION class=_figcaption_abn6g_8 style="BOX-SIZING: border-box; COLOR: ; PADDING-BOTTOM: 0.5em; FONT-STYLE: italic; TEXT-ALIGN: right; PADDING-TOP: 0.8em; PADDING-LEFT: 0.8em; PADDING-RIGHT: 0.8em">A diagram with a row of blue on the left, light yellow in the middle and upper right, and darker yellow on the upper right with a long arrow shooting across below going rightward.</FIGCAPTION></FIGURE> </FONT>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>With the Circuit Breaker pattern in place, the application would instead only get network errors up to the configured threshold (100) each second, and the remaining 900 operations within that one-second window would instead immediately raise an exception rather than trying to connect to the database server. As a result, the application would only churn 100 connections each second rather than 1,000.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>In other words, the impact of a network failure is limited to churning 100 connections per second, and the system only needs to be designed to handle that limited amount of load amplification.</FONT></P><FIGURE class=_figure_abn6g_1 style='BOX-SIZING: border-box; FONT-SIZE: medium; FONT-FAMILY: "Neue Helvetica Now Pro", system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); OUTLINE-WIDTH: 1px; FONT-STYLE: normal; OUTLINE-STYLE: solid; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 20px; DISPLAY: flex; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; flex-direction: column'><FONT class=extract><IMG class="_image_espsy_21 _img_abn6g_17" style="BOX-SIZING: border-box; MARGIN-BOTTOM: 0px; CURSOR: pointer; MAX-WIDTH: 100%; HEIGHT: auto" alt=circuit-breaker-pattern-steady-state-network-failure-recovered-state src="https://images.ctfassets.net/drk57q8lctrm/2TTUK6fXHfGNw5AXLlXIHp/126a42d7e6ab42fa796b8c04cac2d0c1/circuit-breaker-pattern-steady-state-network-failure-recovered-state.webp" width=1920 height=741 data-id="2TTUK6fXHfGNw5AXLlXIHp"><FIGCAPTION class=_figcaption_abn6g_8 style="BOX-SIZING: border-box; COLOR: ; PADDING-BOTTOM: 0.5em; FONT-STYLE: italic; TEXT-ALIGN: right; PADDING-TOP: 0.8em; PADDING-LEFT: 0.8em; PADDING-RIGHT: 0.8em">a diagram in three colors, with blue on the left, light yellow in the middle and bottom right, and bolder yellow on the upper right.</FIGCAPTION></FIGURE> </FONT>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>The application would then handle the exceptions raised when the circuit breaker has tripped according to the use case. For example, the application may abandon those operations as a hard failure, implement an<SPAN>&nbsp;</SPAN></FONT><A style='BOX-SIZING: border-box; CURSOR: pointer; TEXT-DECORATION: none; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; BORDER-BOTTOM: rgb(0,122,171) 1px solid; COLOR: ' href="https://en.wikipedia.org/wiki/Exponential_backoff"><FONT class=extract>exponential backoff</FONT></A><FONT class=extract>, save those operations in a<SPAN>&nbsp;</SPAN></FONT><A style='BOX-SIZING: border-box; CURSOR: pointer; TEXT-DECORATION: none; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; BORDER-BOTTOM: rgb(0,122,171) 1px solid; COLOR: ' href="https://en.wikipedia.org/wiki/Dead_letter_queue"><FONT class=extract>dead letter queue</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>to be replayed later, etc.</FONT></P>
<H2 id=aerospike_circuit_breaker_in_java class=tocHeading style='BOX-SIZING: border-box; FONT-SIZE: 26px; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 500; COLOR: rgb(26,26,26); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 30px; PADDING-LEFT: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Aerospike circuit breaker in Java</FONT></H2>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>The Circuit Breaker pattern is enabled in the Aerospike Java client by default. However, you can tune the number of errors per<SPAN>&nbsp;</SPAN></FONT><A style='BOX-SIZING: border-box; CURSOR: pointer; TEXT-DECORATION: none; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; BORDER-BOTTOM: rgb(0,122,171) 1px solid; COLOR: ' href="https://discuss.aerospike.com/t/faq-what-is-the-tend-interval/7276"><FONT class=extract>tend interval</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>(approx. 1 second) to suit your use case.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>For example, to reduce the threshold from the default value of 100 errors per second to 25 errors per second:</FONT></P><SECTION class=_codeSectionEmbedded_1u426_2 style='BOX-SIZING: border-box; FONT-SIZE: medium; FONT-FAMILY: "Neue Helvetica Now Pro", system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><PRE tabIndex=0 class="shiki material-theme" style='BOX-SIZING: border-box; OVERFLOW: auto; WHITE-SPACE: pre; COLOR: rgb(238,255,255); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; FONT: 14px/22px SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; PADDING-LEFT: 0px; MARGIN: 0px 0px 20px; DISPLAY: block; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(38,50,56); border-radius: 20px'><CODE style="BOX-SIZING: border-box; FONT-SIZE: 14px; BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: medium none; COUNTER-INCREMENT: step 0; PADDING-BOTTOM: 0px; PADDING-TOP: 0.5em; PADDING-LEFT: 0px; BORDER-LEFT: medium none; COUNTER-RESET: step 0; PADDING-RIGHT: 0px; border-radius: 0.4rem"><FONT class=extract><SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(247,140,108)">import</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)"> com</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">aerospike</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">client</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">IAerospikeClient</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">;</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(247,140,108)">import</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)"> com</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">aerospike</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">client</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">Host</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">;</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(247,140,108)">import</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)"> com</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">aerospike</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">client</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">policy</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">ClientPolicy</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">;</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(247,140,108)">import</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)"> com</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">aerospike</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">client</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">proxy</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">AerospikeClientFactory</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">;</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">Host</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">[]</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)"> hosts </SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">=</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255); FONT-STYLE: italic"> new</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)"> Host</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">[]</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)"> {</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255); FONT-STYLE: italic">    new</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(130,170,255)"> Host</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">(</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">"</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(195,232,141)">127.0.0.1</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">"</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">,</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(247,140,108)"> 3000</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">),</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">};</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">ClientPolicy</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)"> policy </SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">=</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255); FONT-STYLE: italic"> new</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(130,170,255)"> ClientPolicy</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">();</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)">policy</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)">maxErrorRate </SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">=</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(247,140,108)"> 25</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">;</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(84,110,122); FONT-STYLE: italic"> // default=100</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(199,146,234)">IAerospikeClient</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)"> client </SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">=</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)"> AerospikeClientFactory</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(130,170,255)">getClient</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">(</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)">policy</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">,</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)"> false,</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)"> hosts</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">);</SPAN></SPAN></FONT></CODE></PRE></SECTION>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>The application would then handle the exceptions raised when the circuit breaker threshold has been tripped using the MAX_ERROR_RATE attribute of the ResultCode member of the exception:</FONT></P><SECTION class=_codeSectionEmbedded_1u426_2 style='BOX-SIZING: border-box; FONT-SIZE: medium; FONT-FAMILY: "Neue Helvetica Now Pro", system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><PRE tabIndex=0 class="shiki material-theme" style='BOX-SIZING: border-box; OVERFLOW: auto; WHITE-SPACE: pre; COLOR: rgb(238,255,255); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; FONT: 14px/22px SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; PADDING-LEFT: 0px; MARGIN: 0px 0px 20px; DISPLAY: block; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(38,50,56); border-radius: 20px'><CODE style="BOX-SIZING: border-box; FONT-SIZE: 14px; BORDER-TOP: medium none; BORDER-RIGHT: medium none; BORDER-BOTTOM: medium none; COUNTER-INCREMENT: step 0; PADDING-BOTTOM: 0px; PADDING-TOP: 0.5em; PADDING-LEFT: 0px; BORDER-LEFT: medium none; COUNTER-RESET: step 0; PADDING-RIGHT: 0px; border-radius: 0.4rem"><FONT class=extract><SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255); FONT-STYLE: italic">switch</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)"> (e</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(130,170,255)">getResultCode</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)">()) </SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">{</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(84,110,122); FONT-STYLE: italic">    // ...</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255); FONT-STYLE: italic">    case</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)"> ResultCode</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">.</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(238,255,255)">MAX_ERROR_RATE</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">:</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(84,110,122); FONT-STYLE: italic">        // Exceeded max number of errors per tend interval (~1s)</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(84,110,122); FONT-STYLE: italic">        // The operation can be queued for retry with something like</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(84,110,122); FONT-STYLE: italic">        // like an exponential backoff, captured in a dead letter</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(84,110,122); FONT-STYLE: italic">        // queue, etc.</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255); FONT-STYLE: italic">        break</SPAN><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">;</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(84,110,122); FONT-STYLE: italic">    // ...</SPAN></SPAN>
<SPAN class=line style="BOX-SIZING: border-box"><SPAN style="BOX-SIZING: border-box; COLOR: rgb(137,221,255)">}</SPAN></SPAN></FONT></CODE></PRE></SECTION>
<H2 id=example_code class=tocHeading style='BOX-SIZING: border-box; FONT-SIZE: 26px; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 500; COLOR: rgb(26,26,26); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 30px; PADDING-LEFT: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Example code</FONT></H2>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>This is an<SPAN>&nbsp;</SPAN></FONT><A style='BOX-SIZING: border-box; CURSOR: pointer; TEXT-DECORATION: none; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; BORDER-BOTTOM: rgb(0,122,171) 1px solid; COLOR: ' href="https://github.com/aerospike-examples/aerospike-circuit-breaker-java"><FONT class=extract>example Java application</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>that demonstrates how the Circuit Breaker design pattern is implemented in Aerospike. It includes examples of error handling and instructions on simulating failures.</FONT></P>
<H2 id=tuning_the_circuit_breaker_threshold class=tocHeading style='BOX-SIZING: border-box; FONT-SIZE: 26px; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 500; COLOR: rgb(26,26,26); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 30px; PADDING-LEFT: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Tuning the circuit breaker threshold</FONT></H2>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>While the default value of<SPAN>&nbsp;</SPAN><CODE style="BOX-SIZING: border-box; FONT-SIZE: 17px; PADDING-TOP: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(246,247,248); border-radius: 0.4rem">maxErrorRate=100</CODE><SPAN>&nbsp;</SPAN>has been proven to protect against metastable failures by the Aerospike performance engineering team, the optimal value ultimately depends on the use case.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>Setting the threshold effectively puts a cap on the number of connections that are churned per second (approximately) in a worst-case failure scenario. The cost of a connection churn can vary. For example, a TLS connection takes more resources to establish than a plain TCP connection. Logging a message on every failure is more expensive than incrementing a counter.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>So the questions you have to ask are:</FONT></P>
<UL style='BOX-SIZING: border-box; FONT-SIZE: medium; FONT-FAMILY: "Neue Helvetica Now Pro", system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 5px 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style="BOX-SIZING: border-box">
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family)"><FONT class=extract>How many connections opened/closed per second can each of my application nodes reasonably handle?</FONT></P>
<LI style="BOX-SIZING: border-box">
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family)"><FONT class=extract>How many connections opened/closed per second can each of my database nodes reasonably handle?</FONT></P></LI></UL>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>Every Aerospike client instance connects to every server node. So, with 50 application nodes and the default value of<SPAN>&nbsp;</SPAN><CODE style="BOX-SIZING: border-box; FONT-SIZE: 17px; PADDING-TOP: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(246,247,248); border-radius: 0.4rem">maxErrorRate=100</CODE>, a single database node might see approximately 5,000 connections churned per second in the worst-case failure mode.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>Then, consider what happens on the server when a connection churns. Depending on the type of failure, there might be a log message from the failure. When using the<SPAN>&nbsp;</SPAN></FONT><A style='BOX-SIZING: border-box; CURSOR: pointer; TEXT-DECORATION: none; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; BORDER-BOTTOM: rgb(0,122,171) 1px solid; COLOR: ' href="https://aerospike.com/docs/server/operations/configure/security/access-control"><FONT class=extract>Aerospike authentication and audit logs</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>there can be an audit log message for the attempted authentication while connecting. So with those two log messages there could be approximately 10,000 log messages per second during this type of failure mode.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>Can your logging stack handle that volume from each Aerospike node?</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>Dropping the value down to<SPAN>&nbsp;</SPAN><CODE style="BOX-SIZING: border-box; FONT-SIZE: 17px; PADDING-TOP: 0px; PADDING-LEFT: 0px; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(246,247,248); border-radius: 0.4rem">maxErrorRate=5</CODE><SPAN>&nbsp;</SPAN>would lower that worst-case log volume down to approximately 250 log messages per second. The trade-off would be that a larger number of the transactions during that window would need to be addressed by the application (exponential back-off, dead-letter queue, etc).</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>But that trade-off is acceptable if you leverage other techniques for resiliency at scale, such that the Circuit Breaker pattern is a last resort for just the most extreme failure scenarios. Less severe disruptions, such as high packet loss, single node failures, short-lived latency spikes, etc., can be mitigated before tripping the circuit breaker in the first place.</FONT></P>
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><FONT class=extract>The policies that can provide that additional resilience at scale are documented in the<SPAN>&nbsp;</SPAN></FONT><A style='BOX-SIZING: border-box; CURSOR: pointer; TEXT-DECORATION: none; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; BORDER-BOTTOM: rgb(0,122,171) 1px solid; COLOR: ' href="https://aerospike.com/developer/client/connection_tuning_guide"><FONT class=extract>Aerospike Connection Tuning Guide</FONT></A><FONT class=extract>. An in-depth explanation about how they work is discussed in<SPAN>&nbsp;</SPAN></FONT><A style='BOX-SIZING: border-box; CURSOR: pointer; TEXT-DECORATION: none; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; BORDER-BOTTOM: rgb(0,122,171) 1px solid; COLOR: ' href="https://aerospike.com/blog/using-aerospike-policies-correctly/"><FONT class=extract>Using Aerospike policies (correctly!)</FONT></A><FONT class=extract>.</FONT></P>
<H2 id=key_takeaways class=tocHeading style='BOX-SIZING: border-box; FONT-SIZE: 26px; FONT-FAMILY: var(--helvetica, "Neue Helvetica Now Pro"),Helvetica; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 500; COLOR: rgb(26,26,26); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 30px; PADDING-LEFT: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Key takeaways</FONT></H2>
<UL style='BOX-SIZING: border-box; FONT-SIZE: medium; FONT-FAMILY: "Neue Helvetica Now Pro", system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Noto Sans", sans-serif, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(26,26,26); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 5px 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style="BOX-SIZING: border-box">
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family)"><FONT class=extract>For large-scale and high-throughput applications, it is critical for applications to be designed for resilience to network disruptions.</FONT></P>
<LI style="BOX-SIZING: border-box">
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family)"><FONT class=extract>The circuit breaker design pattern protects the application and the database from failures that could otherwise overwhelm the system.</FONT></P>
<LI style="BOX-SIZING: border-box">
<P style="BOX-SIZING: border-box; FONT-FAMILY: var(--desktop-large-body-copy-family)"><FONT class=extract>The Aerospike client libraries implement a circuit breaker pattern and expose it to developers as a simple policy configuration.</FONT></P></LI></UL>