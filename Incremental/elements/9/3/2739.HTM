<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/elasticloadbalancing" rel=noopener target=_blank><FONT class=extract>Elastic Load Balancing</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>(ELB) offers four types of load balancers, all featuring high availability, automatic scaling, and robust security support for your applications:<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/elasticloadbalancing/application-load-balancer/" rel=noopener target=_blank><FONT class=extract>Application Load Balancer (ALB)</FONT></A><FONT class=extract>,<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/elasticloadbalancing/network-load-balancer/" rel=noopener target=_blank><FONT class=extract>Network Load Balancer (NLB)</FONT></A><FONT class=extract>,<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/elasticloadbalancing/gateway-load-balancer/" rel=noopener target=_blank><FONT class=extract>Gateway Load Balancer (GWLB)</FONT></A><FONT class=extract>, and<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/elasticloadbalancing/classic-load-balancer/" rel=noopener target=_blank><FONT class=extract>Classic Load Balancer (CLB)</FONT></A><FONT class=extract>.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>ELB automatically scales up and down, and scales in and out in response to traffic load, to help manage requests by optimally routing incoming traffic. The load balancer scaling system scales up and out very aggressively in response to the incoming traffic, and keeps enough capacity to withstand an<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-regions-availability-zones.html#concepts-availability-zones" rel=noopener target=_blank><FONT class=extract>Availability Zone (AZ)</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>impairment. On the other hand, scaling in/down happens very conservatively.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>In certain scenarios, as discussed in the subsequent sections, sharding may be needed. Sharding is a form of horizontal scaling that helps to deliver a high degree of reliability and enables higher scalability of applications by distributing the workload across multiple load balancers through Domain Name Service (DNS) using<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/route53/" rel=noopener target=_blank><FONT class=extract>Amazon Route 53</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>pointing to the same set of backend targets. Similar to sharding a database, where a large database or table is broken up into smaller chunks distributed across multiple servers, you shard the overall capacity of the workload and segment it into multiple load balancers. This way, each load balancer shard is responsible for handling a subset of requests, thereby distributing the load across multiple load balancers. The process of sharding is driven by customers, and AWS does not manage sharding automatically for you.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>In this post, we discuss considerations for sharding your NLB, ALB and CLB along with how to implement sharding for ELB to handle large volumes of traffic. We have created a<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://github.com/" rel=noopener target=_blank><FONT class=extract>GitHub</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>repository for code samples that can optionally help accelerate the sharding of your ELB. This repository includes samples for<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/cloudformation/" rel=noopener target=_blank><FONT class=extract>AWS CloudFormation</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>templates</FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://github.com/aws/elastic-load-balancing-tools/tree/master/elb_ip_monitoring" rel=noopener target=_blank><FONT class=extract><SPAN>&nbsp;</SPAN>to monitor the IP addresses being used by either an ALB or CLB</FONT></A><FONT class=extract>, and<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://github.com/aws/elastic-load-balancing-tools/tree/master/sharding" rel=noopener target=_blank><FONT class=extract>automate the process to create Route 53 resource records</FONT></A><FONT class=extract>.</FONT></P>
<H2 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Overview of ELB Sharding</FONT></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Without sharding, a single ELB handles all of the traffic. With sharding, the overall traffic is distributed across multiple ELBs, with each ELB handling a portion of the overall traffic. Figure 1 shows a high-level view of the sharding technique using Amazon Route 53.</FONT></P>
<DIV id=attachment_21410 class="wp-caption aligncenter" style='BOX-SIZING: border-box; FONT-SIZE: 14px; MAX-WIDTH: 100%; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WIDTH: 628px; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN-LEFT: auto; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; MARGIN-RIGHT: auto; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig1.png" rel=noopener target=_blank><FONT class=extract><IMG aria-describedby=caption-attachment-21410 class="wp-image-21410 size-full" style="BOX-SIZING: border-box; MAX-WIDTH: 100%; BORDER-TOP: 0px; HEIGHT: auto; BORDER-RIGHT: 0px; WIDTH: auto; BORDER-BOTTOM: 0px; BORDER-LEFT: 0px" alt="Figure 1: High-level view of ELB without/with sharding concept" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig1.png" width=618 height=578></FONT></A><FONT class=extract> </FONT>
<P id=caption-attachment-21410 class=wp-caption-text style="BOX-SIZING: border-box; MARGIN-TOP: 0px; COLOR: rgb(35,47,62); FONT-STYLE: italic"><FONT class=extract>Figure 1: High-level view of ELB without/with sharding concept</FONT></P></DIV>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Note: Sharding discussed here is a different concept than<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/builders-library/workload-isolation-using-shuffle-sharding/" rel=noopener target=_blank><FONT class=extract>Shuffle sharding</FONT></A><FONT class=extract>, which is at the target level.</FONT></P>
<H2 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>Application Load Balancer and Classic Load Balancer Sharding Considerations</FONT></STRONG></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>ALB and CLB automatically distribute incoming application traffic across multiple targets in one or more AZs. ALB first scales up and then starts scaling out. When you create an Internet or internal-facing ALB or CLB, we create at least one load balancer node in each configured AZ. For internet-facing ALB or CLB, each node has a public IP address available in DNS record, and a private IP address available using the<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/ec2/" rel=noopener target=_blank><FONT class=extract>Amazon EC2</FONT></A><SPAN><FONT class=extract>&nbsp;</FONT></SPAN><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/ec2/describe-network-interfaces.html" rel=noopener target=_blank><FONT class=extract>describe-network-interfaces</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>API call. For internal-facing ALB or CLB, each node has a private IP address and is available in the DNS record. Each node consumes a single IP address per subnet. To ensure that your load balancer can scale properly, we recommend that you use a minimum subnet size of /27 bitmask for your load balancer subnets and have at least<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/application-load-balancers.html#subnets-load-balancer" rel=noopener target=_blank><FONT class=extract>eight free IP addresses</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>per subnet. ALB and CLB can scale up to a maximum of 100 active nodes created across all AZs. Once the load balancer reaches close to the maximum supported 100 active nodes across all AZs, sharding becomes necessary.</FONT></P>
<H2 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>When to shard your Application Load Balancer and Classic Load Balancer</FONT></STRONG></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>ELB uses DNS as the point where clients should send traffic. We monitor the health and status of the resources supporting each IP address and update the load balancer DNS record to contain only IPs of healthy and appropriately scaled resources. There are several operations that can cause the IP addresses for a given ALB or CLB to change. When they do change, new IPs will be added to DNS and the old IPs will be removed. To use ALB and CLBs, we recommend clients to resolve the ELB DNS name and follow the best practices of honoring DNS TTLs (1 minute for all ELBs), retrying failed requests with<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/builders-library/timeouts-retries-and-backoff-with-jitter/" rel=noopener target=_blank><FONT class=extract>exponential backoff and jitter,</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>and refreshing DNS after a connection failure. Today, when you create a load balancer, we create a DNS record for it and return a maximum of 8 random IP addresses. This is done to fit the response in a single UDP query response. To determine whether your load balancer needs sharding, you need to get the total number of active nodes on your load balancer, and you can do that by prepending &#8216;<STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>all</STRONG>&#8216; to the load balancer DNS name as shown below. Please note that this may include the nodes that are unhealthy. We recommend using this DNS name only for troubleshooting or capacity alerting, not to determine where traffic can be sent. We also published<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://github.com/aws/elastic-load-balancing-tools/tree/master/elb_ip_monitoring" rel=noopener target=_blank><FONT class=extract>a sample CloudFormation script</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>that you can optionally use to monitor the IP addresses of your load balancer through a custom<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/WhatIsCloudWatch.html" rel=noopener target=_blank><FONT class=extract>Amazon CloudWatch</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>metric.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>To determine the number of active nodes your load balancer uses, you can use<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://en.wikipedia.org/wiki/Dig_(command)" rel=noopener target=_blank><FONT class=extract>dig</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>and note the output.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>The syntax is:<SPAN>&nbsp;</SPAN></FONT><CODE style='BOX-SIZING: border-box; BORDER-TOP: rgb(247,247,247) 1px solid; FONT-FAMILY: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace; BORDER-RIGHT: rgb(247,247,247) 1px solid; BORDER-BOTTOM: rgb(247,247,247) 1px solid; COLOR: rgb(192,57,43); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 5px; BORDER-LEFT: rgb(247,247,247) 1px solid; DISPLAY: inline-block; PADDING-RIGHT: 5px; BACKGROUND-COLOR: rgb(247,247,247); border-radius: 0px'><FONT class=extract>% dig +short all.&lt;FQDN_of_your_ALB or CLB&gt; | wc -l</FONT></CODE></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><CODE style='BOX-SIZING: border-box; BORDER-TOP: rgb(247,247,247) 1px solid; FONT-FAMILY: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace; BORDER-RIGHT: rgb(247,247,247) 1px solid; BORDER-BOTTOM: rgb(247,247,247) 1px solid; COLOR: rgb(192,57,43); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 5px; BORDER-LEFT: rgb(247,247,247) 1px solid; DISPLAY: inline-block; PADDING-RIGHT: 5px; BACKGROUND-COLOR: rgb(247,247,247); border-radius: 0px'><FONT class=extract>% dig +short all.www-example-com-1234567890.us-east-1.elb.amazonaws.com | wc -l</FONT></CODE></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Based on the result from the above command, you can use the following table to determine the need for sharding.</FONT></P>
<TABLE class=aligncenter style='BOX-SIZING: border-box; FONT-SIZE: 14px; MAX-WIDTH: 100%; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; BORDER-TOP-COLOR: rgb(0,0,0); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; BORDER-LEFT-COLOR: rgb(0,0,0); FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; BORDER-BOTTOM-COLOR: rgb(0,0,0); ORPHANS: 2; WIDOWS: 2; MARGIN: 30px auto; DISPLAY: block; BORDER-RIGHT-COLOR: rgb(0,0,0); LETTER-SPACING: normal; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial' border=1>
<TBODY style="BOX-SIZING: border-box">
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box"><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>Number of active ALB or CLB nodes across all AZs (Result)</FONT></STRONG></TD>
<TD style="BOX-SIZING: border-box"><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>Recommendation</FONT></STRONG></TD></TR>
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box"><FONT class=extract>Equal to or less than 12</FONT></TD>
<TD style="BOX-SIZING: border-box">
<TABLE style="BOX-SIZING: border-box; MARGIN-BOTTOM: 30px; MARGIN-TOP: 30px">
<TBODY style="BOX-SIZING: border-box">
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box"><FONT class=extract>Sharding is not needed.</FONT></TD></TR></TBODY></TABLE></TD></TR>
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box"><FONT class=extract>Between 12 and 50</FONT></TD>
<TD style="BOX-SIZING: border-box">
<TABLE style="BOX-SIZING: border-box; MARGIN-BOTTOM: 30px; MARGIN-TOP: 30px">
<TBODY style="BOX-SIZING: border-box">
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box"><FONT class=extract>Sharding is not needed. Continue to monitor your load balancer</FONT></TD></TR></TBODY></TABLE></TD></TR>
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box"><FONT class=extract>More than 50</FONT></TD>
<TD style="BOX-SIZING: border-box"><FONT class=extract>You should look at your load balancers historical traffic and determine how long it will be until it doubles, and then plan to shard at that time</FONT></TD></TR>
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box"><FONT class=extract>Equal to or more than 99</FONT></TD>
<TD style="BOX-SIZING: border-box"><FONT class=extract>You are already at the maximum number of ALB or CLB nodes, sharding is required immediately.</FONT></TD></TR></TBODY></TABLE>
<H2 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>Network Load Balancer sharding considerations</FONT></STRONG></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>NLB (and GWLB which is out of scope of this blog) is built on top of<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://youtu.be/dfEcd3zqPOA?t=4665" rel=noopener target=_blank><FONT class=extract>AWS Hyperplane</FONT></A><FONT class=extract>, a distributed network function virtualization system deployed in each AZ within a Region. When you create an Internet-facing NLB, it creates an<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html" rel=noopener target=_blank><FONT class=extract>Elastic Network Address (ENI)</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>and assigns an AWS assigned public IP per subnet for you, which is available in the DNS record. You can also optionally choose to specify one of your own<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html" rel=noopener target=_blank><FONT class=extract>Elastic IP addresses</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>(EIP). For internal-facing NLB, it creates an ENI and assigns a private IP address per subnet for you, which is also available in the DNS record. These EIPs for Internet-facing or private IP addresses for internal-facing NLB provide your load balancer with static IP addresses that will not change during the life of the load balancer. The scaling happens transparently for your NLB and independently on a per-ENI basis. If you have created a NLB with 3 AZs, then it creates 3 ENIs on the same NLB and all these ENIs (because they&#8217;re in different AZs) do not share scaling information. Therefore, all the ENIs of the same NLB will scale independently based on the traffic detected in that AZ.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>To shard your NLB, we recommend customers plan in terms of NLB AZ, meaning 1 NLB with 3 AZs counts as 3 NLB AZs regardless of whether these are 3 NLBs each with 1 AZ or 1 NLB with 3 AZs. This does mean that some workloads will require multiple NLBs. To plan for NLB sharding, we recommend using 100Gbps per NLB/AZ (ENI) as the sharding threshold. Keeping the used capacity in each NLB/AZ (ENI) to be no more than 100 Gbps helps reduce blast radius. Refer to the Observability with Amazon CloudWatch Metrics section later in the blog for more info.</FONT></P>
<H2 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>Sharding architectures</FONT></STRONG></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>In this section, we will focus on single and multi-Region sharding scenarios. Figure 2 below shows an architecture with a single-Region, single ELB, across multiple AZs,<SPAN>&nbsp;</SPAN><EM style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif'>without</EM><SPAN>&nbsp;</SPAN>sharding. In this example, you create a single<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-choosing-alias-non-alias.html" rel=noopener target=_blank><FONT class=extract>Route 53 alias record</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>targeting the ELB, which handles 100% of the incoming requests. This architecture covers majority of the use-cases without the need for sharding, as the ELB will scale automatically by adding either more nodes (scale out) or larger nodes (scale up) to handle the incoming requests.</FONT></P>
<DIV id=attachment_21422 class="wp-caption aligncenter" style='BOX-SIZING: border-box; FONT-SIZE: 14px; MAX-WIDTH: 100%; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WIDTH: 1031px; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN-LEFT: auto; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; MARGIN-RIGHT: auto; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig2-1.png" rel=noopener target=_blank><FONT class=extract><IMG aria-describedby=caption-attachment-21422 class="wp-image-21422 size-full" style="BOX-SIZING: border-box; MAX-WIDTH: 100%; BORDER-TOP: 0px; HEIGHT: auto; BORDER-RIGHT: 0px; WIDTH: auto; BORDER-BOTTOM: 0px; BORDER-LEFT: 0px" alt="Figure 2: Single-Region without sharding" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig2-1.png" width=1021 height=907 loading="lazy"></FONT></A><FONT class=extract> </FONT>
<P id=caption-attachment-21422 class=wp-caption-text style="BOX-SIZING: border-box; MARGIN-TOP: 0px; COLOR: rgb(35,47,62); FONT-STYLE: italic"><FONT class=extract>Figure 2: Single-Region without sharding</FONT></P></DIV>
<H1 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>1. Single-Region with sharding</FONT></STRONG></H1>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>As you determine that ELB sharding may be necessary based on the aforementioned criteria, you then shard the ELB as shown in Figure 3 below. You first determine how many ELBs are needed based on the requirement in question. In the example below, we use two ELBs to handle the incoming requests. Both ELBs point to the same targets. You can register the same target with multiple target groups. To split the load (shard) between the two ELBs, you can use Route 53<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy-weighted.html" rel=noopener target=_blank><FONT class=extract>weighted routing policy</FONT></A><FONT class=extract>. Weighted routing lets you associate multiple resources with a single domain name (example.com) or subdomain name (acme.example.com) and choose how much traffic is routed to each resource. In Figure 2, we create two<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-choosing-alias-non-alias.html" rel=noopener target=_blank><FONT class=extract>Route 53 alias records</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>by pointing the same domain (public hosted zone) www.example.com to the respective ELBs (load-balancer-1-&lt;xxxxxxxxxx&gt;.<U style="BOX-SIZING: border-box">us-east-1.elb.amazonaws.com</U><SPAN>&nbsp;</SPAN>and load-balancer-2-&lt;yyyyyyyyyy&gt;.<U style="BOX-SIZING: border-box">us-east-1.elb.amazonaws.com</U>). We then assign each record a relative weight that corresponds with how much traffic you want to send to each ELB. Here we are splitting the traffic evenly, therefore each ELB will receive 50% of the incoming requests. If you want to stop sending traffic to a resource, you can change the weight for that record to zero. Refer to<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy-weighted.html" rel=noopener target=_blank><FONT class=extract>Route 53 Weighted routing</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>documentation for details.</FONT></P>
<DIV id=attachment_21423 class="wp-caption aligncenter" style='BOX-SIZING: border-box; FONT-SIZE: 14px; MAX-WIDTH: 100%; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WIDTH: 1131px; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN-LEFT: auto; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; MARGIN-RIGHT: auto; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig3-1.png" rel=noopener target=_blank><FONT class=extract><IMG aria-describedby=caption-attachment-21423 class="wp-image-21423 size-full" style="BOX-SIZING: border-box; MAX-WIDTH: 100%; BORDER-TOP: 0px; HEIGHT: auto; BORDER-RIGHT: 0px; WIDTH: auto; BORDER-BOTTOM: 0px; BORDER-LEFT: 0px" alt="Figure 3: Single-Region with sharding" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig3-1.png" width=1121 height=939 loading="lazy"></FONT></A><FONT class=extract> </FONT>
<P id=caption-attachment-21423 class=wp-caption-text style="BOX-SIZING: border-box; MARGIN-TOP: 0px; COLOR: rgb(35,47,62); FONT-STYLE: italic"><FONT class=extract>Figure 3: Single-Region with sharding</FONT></P></DIV>
<H1 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>2. Multi-Region sharding</FONT></H1>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>In multi-Region sharding (Figure 4), we replicate the same setup in multiple AWS Regions. Region 1 and Region 2 both have multiple ELBs sharded to handle the incoming traffic requests within the respective Region. This is achieved using Route 53<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy-weighted.html" rel=noopener target=_blank><FONT class=extract>weighted routing policy</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>as described in the previous section to distribute the incoming traffic between the ELB shards. To improve performance for your users by serving their requests from the AWS Region that provides the lowest latency, we can setup<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-policy-latency.html" rel=noopener target=_blank><FONT class=extract>Route 53 Latency-based routing</FONT></A><FONT class=extract>. This way, users will be served from the closest Region based on the latency and then to the ELB shard based on the corresponding Route 53 weight assigned. You can create records one at a time, but it may be challenging to keep track of the relationships among the records when you are reviewing the settings in the Route 53 console. Optionally,<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/traffic-flow.html" rel=noopener target=_blank><FONT class=extract>Route 53 Traffic flow</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>can help simplify the process of creating and maintaining records in large and complex configurations via visual editor (Figure 4) for e.g., by combining latency-based routing with weighted routing policy. Refer to<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/traffic-flow.html" rel=noopener target=_blank><FONT class=extract>Route 53 traffic flow documentation</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>for more details.</FONT></P>
<DIV id=attachment_21424 class="wp-caption aligncenter" style='BOX-SIZING: border-box; FONT-SIZE: 14px; MAX-WIDTH: 100%; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WIDTH: 2291px; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN-LEFT: auto; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; MARGIN-RIGHT: auto; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig4-1.png" rel=noopener target=_blank><FONT class=extract><IMG aria-describedby=caption-attachment-21424 class="wp-image-21424 size-full" style="BOX-SIZING: border-box; MAX-WIDTH: 100%; BORDER-TOP: 0px; HEIGHT: auto; BORDER-RIGHT: 0px; WIDTH: auto; BORDER-BOTTOM: 0px; BORDER-LEFT: 0px" alt="Figure 4: Multi-Region sharding [Click the image to see a larger version in a new tab]" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig4-1.png" width=2281 height=917 loading="lazy"></FONT></A><FONT class=extract> </FONT>
<P id=caption-attachment-21424 class=wp-caption-text style="BOX-SIZING: border-box; MARGIN-TOP: 0px; COLOR: rgb(35,47,62); FONT-STYLE: italic"><FONT class=extract>Figure 4: Multi-Region sharding [Click the image to see a larger version in a new tab]</FONT></P></DIV>
<H2 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>How to shard your ELB</FONT></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>ELB sharding requires thoughtful planning and requires you to take your future growth in to consideration, therefore understand the pre-requisites before getting started. In this section, we will use ALB as an example to show how to shard your load balancer, but the process remains the same for NLB and CLB.</FONT></P>
<H1 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>Pre-requisites</FONT></STRONG></H1>
<UL style='LIST-STYLE-TYPE: disc; BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 0px; PADDING-LEFT: 20px; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 0px 2px; LETTER-SPACING: normal; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract>Create a new<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/CreatingHostedZone.html" rel=noopener target=_blank><FONT class=extract>Route 53 public hosted zone</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>or leverage an existing public hosted zone if you are already using Amazon Route 53 </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract>Create a separate<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-target-group.html" rel=noopener target=_blank><FONT class=extract>target group</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>for each load balancer </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 0px"><FONT class=extract>Make sure you have<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-application-load-balancer.html"><FONT class=extract>created</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>the required number of load balancers. In our example, we show two ALBs (ALB1 and ALB2 respectively) both in the us-east-1 Region which we would like to distribute traffic. Note the DNS name of both of your ALBs. Refer to the documentation on<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-creating.html#resource-record-sets-elb-dns-name-procedure" rel=noopener target=_blank><FONT class=extract>Getting the DNS name for an Elastic Load Balancing load balancer</FONT></A><FONT class=extract>: </FONT>
<OL style="BOX-SIZING: border-box; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 20px; MARGIN: 0px 0px 0px 2px; PADDING-RIGHT: 0px">
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px; MARGIN-TOP: 10px"><FONT class=extract>load-balancer-1-xxxxxxxxx.us-east-1.elb.amazonaws.com </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract>load-balancer-2-yyyyyyyyyy.us-east-1.elb.amazonaws.com</FONT></LI></OL></LI></UL>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Once you have created the additional(s) ALBs, make sure to register the same targets behind each load balancer. You can also optionally plan to have different targets per ALB, and can optionally use this<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://github.com/aws/elastic-load-balancing-tools/tree/master/sharding" rel=noopener target=_blank><FONT class=extract>CloudFormation script</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>to create resource records in Amazon Route 53.</FONT></P>
<H1 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>Steps</FONT></STRONG></H1>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Step 1</STRONG>: In your Route 53 hosted zone,<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-creating.html" rel=noopener target=_blank><FONT class=extract>create an Alias resource record</FONT></A><FONT class=extract>, which we will call &#8220;shard.example.com&#8221; pointing to the first ALB (Figure 5).</FONT></P>
<UL style='LIST-STYLE-TYPE: disc; BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 0px; PADDING-LEFT: 20px; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 0px 2px; LETTER-SPACING: normal; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Record name</STRONG>:<SPAN>&nbsp;</SPAN><U style="BOX-SIZING: border-box">example.com</U> </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Record type</STRONG>: A &#8211; Routes traffic to an IPv4 address and some AWS resources </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Alias</STRONG>: Select the toggle </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Value/Route traffic to:<SPAN>&nbsp;</SPAN></STRONG>Choose<SPAN>&nbsp;</SPAN><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Alias to Application and Classic Load Balancer<SPAN>&nbsp;</SPAN></STRONG>or<SPAN>&nbsp;</SPAN><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Alias to Network Load Balancer<SPAN>&nbsp;</SPAN></STRONG>for endpoint, select the region the endpoint is in and then select the first load balancer you want to add to the shard. </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Routing Policy</STRONG>: Select the<SPAN>&nbsp;</SPAN><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Weighted</STRONG><SPAN>&nbsp;</SPAN>routing policy from the dropdown and specify a number for the<SPAN>&nbsp;</SPAN><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Weight</STRONG><SPAN>&nbsp;</SPAN>that represents the proportion of traffic to send to this record. </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 0px"><FONT class=extract><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Evaluate target health:<SPAN>&nbsp;</SPAN></STRONG>Click the toggle to enable.</FONT></LI></UL>
<DIV id=attachment_21429 class="wp-caption aligncenter" style='BOX-SIZING: border-box; FONT-SIZE: 14px; MAX-WIDTH: 100%; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WIDTH: 946px; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN-LEFT: auto; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; MARGIN-RIGHT: auto; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig5.png" rel=noopener target=_blank><FONT class=extract><IMG aria-describedby=caption-attachment-21429 class="wp-image-21429 size-full" style="BOX-SIZING: border-box; MAX-WIDTH: 100%; BORDER-TOP: 0px; HEIGHT: auto; BORDER-RIGHT: 0px; WIDTH: auto; BORDER-BOTTOM: 0px; BORDER-LEFT: 0px" alt="Figure 5: Route 53 Console Create record step for ALB1" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig5.png" width=936 height=740 loading="lazy"></FONT></A><FONT class=extract> </FONT>
<P id=caption-attachment-21429 class=wp-caption-text style="BOX-SIZING: border-box; MARGIN-TOP: 0px; COLOR: rgb(35,47,62); FONT-STYLE: italic"><FONT class=extract>Figure 5: Route 53 Console Create record step for ALB1</FONT></P></DIV>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>When you set&nbsp;</FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-values-alias.html#rrsets-values-alias-evaluate-target-health" rel=noopener target=_blank><FONT class=extract>Evaluate target health</FONT></A><FONT class=extract>&nbsp;to&nbsp;<STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Yes</STRONG>&nbsp;for an&nbsp;</FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-choosing-alias-non-alias.html" rel=noopener target=_blank><FONT class=extract>alias record</FONT></A><FONT class=extract>, Route 53 evaluates the health of the resource that the&nbsp;</FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-values-alias.html#rrsets-values-alias-alias-target" rel=noopener target=_blank><FONT class=extract>alias target value</FONT></A><FONT class=extract>&nbsp;specifies. Therefore, it is recommended to set it to Yes.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>The console prepends<SPAN>&nbsp;</SPAN><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>dualstack.</STRONG><SPAN>&nbsp;</SPAN>to the DNS name of the ALB from the same AWS account only. When a client, such as a web browser, requests the IP address for your domain name (example.com) or subdomain name (www.example.com), the client can request an IPv4 address (an A record), an IPv6 address (an AAAA record), or both IPv4 and IPv6 addresses (in separate requests with IPv4 first). The<SPAN>&nbsp;</SPAN><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>dualstack.</STRONG><SPAN>&nbsp;</SPAN>designation allows Route 53 to respond with the appropriate IP address for your load balancer based on which IP address format the client requested. You will need to prepend<SPAN>&nbsp;</SPAN><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>dualstack.</STRONG><SPAN>&nbsp;</SPAN>for ALB from the different account.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Step 2</STRONG>: Repeat the above steps for creating a resource record for ALB2 with exactly the same name shard.example.com. Figure 6 shows the resource record for ALB2.</FONT></P>
<DIV id=attachment_21430 class="wp-caption aligncenter" style='BOX-SIZING: border-box; FONT-SIZE: 14px; MAX-WIDTH: 100%; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WIDTH: 946px; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN-LEFT: auto; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; MARGIN-RIGHT: auto; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig6.png" rel=noopener target=_blank><FONT class=extract><IMG aria-describedby=caption-attachment-21430 class="wp-image-21430 size-full" style="BOX-SIZING: border-box; MAX-WIDTH: 100%; BORDER-TOP: 0px; HEIGHT: auto; BORDER-RIGHT: 0px; WIDTH: auto; BORDER-BOTTOM: 0px; BORDER-LEFT: 0px" alt="Figure 6: Route 53 Console Create record step for ALB2" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/29/ELBShardingFig6.png" width=936 height=744 loading="lazy"></FONT></A><FONT class=extract> </FONT>
<P id=caption-attachment-21430 class=wp-caption-text style="BOX-SIZING: border-box; MARGIN-TOP: 0px; COLOR: rgb(35,47,62); FONT-STYLE: italic"><FONT class=extract>Figure 6: Route 53 Console Create record step for ALB2</FONT></P></DIV>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Upon completion of the above steps, the Route 53 console output will look as shown in Figure 7.</FONT></P>
<DIV id=attachment_21486 class="wp-caption aligncenter" style='BOX-SIZING: border-box; FONT-SIZE: 14px; MAX-WIDTH: 100%; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WIDTH: 2360px; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN-LEFT: auto; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; MARGIN-RIGHT: auto; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/30/ELBShardingFig7-1.png" rel=noopener target=_blank><FONT class=extract><IMG aria-describedby=caption-attachment-21486 class="wp-image-21486 size-full" style="BOX-SIZING: border-box; MAX-WIDTH: 100%; BORDER-TOP: 0px; HEIGHT: auto; BORDER-RIGHT: 0px; WIDTH: auto; BORDER-BOTTOM: 0px; BORDER-LEFT: 0px" alt="Figure 7: Route 53 Console output after creating the ALBs along with alias records" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/04/30/ELBShardingFig7-1.png" width=2350 height=621 loading="lazy"></FONT></A><FONT class=extract> </FONT>
<P id=caption-attachment-21486 class=wp-caption-text style="BOX-SIZING: border-box; MARGIN-TOP: 0px; COLOR: rgb(35,47,62); FONT-STYLE: italic"><FONT class=extract>Figure 7: Route 53 Console output after creating the ALBs along with alias records</FONT></P></DIV>
<H1 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>How will this work?</FONT></H1>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Every time the user performs a DNS lookup on the resource record &#8220;shard.example.com&#8221;, Route53 will return up to 8 IP addresses belonging to ALB nodes from either of the ALBs with a probability that we calculate as follows:</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: center; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><EM style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>p = weight of set 1 / ( (weight of set 1)+(weight of set 2) )</FONT></EM></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Where&nbsp;p&nbsp;represents the probability of the IPs of set 1 being returned, which in this case is:</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: center; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><EM style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>p = 100 / (100+100) = 0.5</FONT></EM></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>So, the probability is 0.5 or 50%.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>You can extend this concept to more than two ALBs, or alter the weights to have very fine granular control over the traffic that you send to each ALB.</FONT></P>
<H2 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>Observability with Amazon CloudWatch Metrics</FONT></STRONG></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>For ALB,<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html" rel=noopener target=_blank><FONT class=extract>CloudWatch metrics</FONT></A><FONT class=extract>, specifically the<SPAN>&nbsp;</SPAN></FONT><CODE style='BOX-SIZING: border-box; BORDER-TOP: rgb(247,247,247) 1px solid; FONT-FAMILY: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace; BORDER-RIGHT: rgb(247,247,247) 1px solid; BORDER-BOTTOM: rgb(247,247,247) 1px solid; COLOR: rgb(192,57,43); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 5px; BORDER-LEFT: rgb(247,247,247) 1px solid; DISPLAY: inline-block; PADDING-RIGHT: 5px; BACKGROUND-COLOR: rgb(247,247,247); border-radius: 0px'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html" rel=noopener target=_blank><FONT class=extract>RequestCount</FONT></A></CODE><FONT class=extract><SPAN>&nbsp;</SPAN>can be used to monitor the result (before and after) of sharding. This metric shows the number of requests processed over IPv4 and IPv6. This metric is only incremented for requests where the load balancer node was able to choose a target. Requests that are rejected before a target is chosen are not reflected in this metric. Figure 7 below shows the ALB request distribution before sharding with ALB1 (blue line) receiving all the traffic and after sharding, with ALB2 (green line) taking 50% of the load thereby evenly distributing the traffic load.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>To monitor the current amount of bytes processed by your NLB, we recommend to monitor the<SPAN>&nbsp;</SPAN></FONT><CODE style='BOX-SIZING: border-box; BORDER-TOP: rgb(247,247,247) 1px solid; FONT-FAMILY: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace; BORDER-RIGHT: rgb(247,247,247) 1px solid; BORDER-BOTTOM: rgb(247,247,247) 1px solid; COLOR: rgb(192,57,43); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 5px; BORDER-LEFT: rgb(247,247,247) 1px solid; DISPLAY: inline-block; PADDING-RIGHT: 5px; BACKGROUND-COLOR: rgb(247,247,247); border-radius: 0px'><FONT class=extract>ProcessedBytes</FONT></CODE><FONT class=extract>,<SPAN>&nbsp;</SPAN></FONT><CODE style='BOX-SIZING: border-box; BORDER-TOP: rgb(247,247,247) 1px solid; FONT-FAMILY: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace; BORDER-RIGHT: rgb(247,247,247) 1px solid; BORDER-BOTTOM: rgb(247,247,247) 1px solid; COLOR: rgb(192,57,43); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 5px; BORDER-LEFT: rgb(247,247,247) 1px solid; DISPLAY: inline-block; PADDING-RIGHT: 5px; BACKGROUND-COLOR: rgb(247,247,247); border-radius: 0px'><FONT class=extract>ProcessedBytes_TCP</FONT></CODE><FONT class=extract>,<SPAN>&nbsp;</SPAN></FONT><CODE style='BOX-SIZING: border-box; BORDER-TOP: rgb(247,247,247) 1px solid; FONT-FAMILY: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace; BORDER-RIGHT: rgb(247,247,247) 1px solid; BORDER-BOTTOM: rgb(247,247,247) 1px solid; COLOR: rgb(192,57,43); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 5px; BORDER-LEFT: rgb(247,247,247) 1px solid; DISPLAY: inline-block; PADDING-RIGHT: 5px; BACKGROUND-COLOR: rgb(247,247,247); border-radius: 0px'><FONT class=extract>ProcessedBytes_TLS</FONT></CODE><FONT class=extract>, and<SPAN>&nbsp;</SPAN></FONT><CODE style='BOX-SIZING: border-box; BORDER-TOP: rgb(247,247,247) 1px solid; FONT-FAMILY: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace; BORDER-RIGHT: rgb(247,247,247) 1px solid; BORDER-BOTTOM: rgb(247,247,247) 1px solid; COLOR: rgb(192,57,43); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 5px; BORDER-LEFT: rgb(247,247,247) 1px solid; DISPLAY: inline-block; PADDING-RIGHT: 5px; BACKGROUND-COLOR: rgb(247,247,247); border-radius: 0px'><FONT class=extract>ProcessedBytes_UDP</FONT></CODE><FONT class=extract><SPAN>&nbsp;</SPAN>CloudWatch metrics depending upon the listener configured on your NLB.</FONT></P>
<DIV id=attachment_21586 class="wp-caption alignnone" style='BOX-SIZING: border-box; FONT-SIZE: 14px; MAX-WIDTH: 100%; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WIDTH: 2866px; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/05/02/ELBShardingFig8-1.png" rel=noopener target=_blank><FONT class=extract><IMG aria-describedby=caption-attachment-21586 class="wp-image-21586 size-full" style="BOX-SIZING: border-box; MAX-WIDTH: 100%; BORDER-TOP: 0px; HEIGHT: auto; BORDER-RIGHT: 0px; WIDTH: auto; BORDER-BOTTOM: 0px; BORDER-LEFT: 0px" alt="" src="https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2024/05/02/ELBShardingFig8-1.png" width=2856 height=1108 loading="lazy"></FONT></A><FONT class=extract> </FONT>
<P id=caption-attachment-21586 class=wp-caption-text style="BOX-SIZING: border-box; MARGIN-TOP: 0px; COLOR: rgb(35,47,62); FONT-STYLE: italic"><FONT class=extract>Figure 8: CloudWatch RequestCount metric showing the before/after results of ALB sharding</FONT></P></DIV>
<H2 style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'><FONT class=extract>Considerations</FONT></STRONG></H2>
<UL style='LIST-STYLE-TYPE: disc; BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 0px; PADDING-LEFT: 20px; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 0px 2px; LETTER-SPACING: normal; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/sticky-sessions.html" rel=noopener target=_blank><FONT class=extract>Sticky sessions</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>for your ALB will not expand across two different load balancers. If you use this feature, be aware that a client might end up in a different target whenever it hits a different load balancer. </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/WhatIsCloudWatch.html" rel=noopener target=_blank><FONT class=extract>CloudWatch</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>metrics and logs are individually emitted per load balancer. </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract>You cannot add two target groups to a single<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/autoscaling/ec2/userguide/auto-scaling-groups.html" rel=noopener target=_blank><FONT class=extract>Auto Scaling Group (ASG</FONT></A><FONT class=extract>), so you will need to create a new ASG with different targets. </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract>There is an overhead of setting up the ALBs, CLBs or NLBs and adding them behind Route 53 with the alias resource records. </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract>Each ALB and CLB node performs health check to all registered targets independently of other nodes. Therefore, with more ALBs and CLBs, the registered targets should be prepared to handle health checks from all ALB and CLB nodes. If<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/how-elastic-load-balancing-works.html" rel=noopener target=_blank><FONT class=extract>cross-zone load balancing</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>attribute is enabled, this will mean that all ALB and CLB nodes will be health checking all target instances. If cross-zone attribute is not enabled, each ALB and CLB node will health check only the registered targets in the same AZ that they are in. </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract>Each additional load balancer will incur additional hourly cost. Refer to the ELB<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/elasticloadbalancing/pricing/" rel=noopener target=_blank><FONT class=extract>pricing</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>page for details. </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 10px"><FONT class=extract>Each additional ALB and CLB also requires at least<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/application-load-balancers.html" rel=noopener target=_blank><FONT class=extract>eight free IP addresses per subnet</FONT></A><FONT class=extract>, to ensure that the load balancer can scale properly. If you determine that you have high number of ALB nodes or ENIs and you want to shard, you will need a significantly higher number of free IPs available. For example, if you have 50 nodes ALB in 5 AZs, 10/AZ, you may need 10 more IPs per AZ to scale to the maximum size of 100 nodes. </FONT>
<LI style="BOX-SIZING: border-box; MARGIN-BOTTOM: 0px"><FONT class=extract>Make sure your ALB and CLB are configured to have the appropriate level of capacity based on expected traffic. We suggest that you should shift traffic using the weighted record slowly, increasing the amount to the new load balancer at no more than double every 5 minutes.</FONT></LI></UL>