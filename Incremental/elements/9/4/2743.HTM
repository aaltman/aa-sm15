<b> : </b><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>When to shard your Application Load Balancer and Classic Load Balancer</STRONG></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>ELB uses DNS as the point where clients should send traffic. We monitor the health and status of the resources supporting each IP address and update the load balancer DNS record to contain only IPs of healthy and appropriately scaled resources. There are several operations that can cause the IP addresses for a given ALB or CLB to change. When they do change, new IPs will be added to DNS and the old IPs will be removed. To use ALB and CLBs, we recommend clients to resolve the ELB DNS name and follow the best practices of honoring DNS TTLs (1 minute for all ELBs), retrying failed requests with<SPAN>&nbsp;</SPAN><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://aws.amazon.com/builders-library/timeouts-retries-and-backoff-with-jitter/" rel=noopener target=_blank>exponential backoff and jitter,</A><SPAN>&nbsp;</SPAN>and refreshing DNS after a connection failure. Today, when you create a load balancer, we create a DNS record for it and return a maximum of 8 random IP addresses. This is done to fit the response in a single UDP query response. To determine whether your load balancer needs sharding, you need to get the total number of active nodes on your load balancer, and you can do that by prepending &#8216;<STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>all</STRONG>&#8216; to the load balancer DNS name as shown below. Please note that this may include the nodes that are unhealthy. We recommend using this DNS name only for troubleshooting or capacity alerting, not to determine where traffic can be sent. We also published<SPAN>&nbsp;</SPAN><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://github.com/aws/elastic-load-balancing-tools/tree/master/elb_ip_monitoring" rel=noopener target=_blank>a sample CloudFormation script</A><SPAN>&nbsp;</SPAN>that you can optionally use to monitor the IP addresses of your load balancer through a custom<SPAN>&nbsp;</SPAN><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/WhatIsCloudWatch.html" rel=noopener target=_blank>Amazon CloudWatch</A><SPAN>&nbsp;</SPAN>metric.</P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>To determine the number of active nodes your load balancer uses, you can use<SPAN>&nbsp;</SPAN><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(9,114,211); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; BACKGROUND-COLOR: transparent; text-underline-offset: 0.4rem" href="https://en.wikipedia.org/wiki/Dig_(command)" rel=noopener target=_blank>dig</A><SPAN>&nbsp;</SPAN>and note the output.</P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>The syntax is:<SPAN>&nbsp;</SPAN><CODE style='BOX-SIZING: border-box; BORDER-TOP: rgb(247,247,247) 1px solid; FONT-FAMILY: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace; BORDER-RIGHT: rgb(247,247,247) 1px solid; BORDER-BOTTOM: rgb(247,247,247) 1px solid; COLOR: rgb(192,57,43); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 5px; BORDER-LEFT: rgb(247,247,247) 1px solid; DISPLAY: inline-block; PADDING-RIGHT: 5px; BACKGROUND-COLOR: rgb(247,247,247); border-radius: 0px'>% dig +short all.&lt;FQDN_of_your_ALB or CLB&gt; | wc -l</CODE></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><CODE style='BOX-SIZING: border-box; BORDER-TOP: rgb(247,247,247) 1px solid; FONT-FAMILY: Consolas, "Andale Mono WT", "Andale Mono", "Lucida Console", "Lucida Sans Typewriter", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono", "Nimbus Mono L", Monaco, "Courier New", Courier, monospace; BORDER-RIGHT: rgb(247,247,247) 1px solid; BORDER-BOTTOM: rgb(247,247,247) 1px solid; COLOR: rgb(192,57,43); PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 5px; BORDER-LEFT: rgb(247,247,247) 1px solid; DISPLAY: inline-block; PADDING-RIGHT: 5px; BACKGROUND-COLOR: rgb(247,247,247); border-radius: 0px'>% dig +short all.www-example-com-1234567890.us-east-1.elb.amazonaws.com | wc -l</CODE></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-BOTTOM: 15px; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 15px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; PADDING-TOP: 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>Based on the result from the above command, you can use the following table to determine the need for sharding.</P>
<TABLE class=aligncenter style='BOX-SIZING: border-box; FONT-SIZE: 14px; MAX-WIDTH: 100%; FONT-FAMILY: AmazonEmber, "Helvetica Neue", Helvetica, Arial, sans-serif; BORDER-TOP-COLOR: rgb(0,0,0); WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; BORDER-LEFT-COLOR: rgb(0,0,0); FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; BORDER-BOTTOM-COLOR: rgb(0,0,0); ORPHANS: 2; WIDOWS: 2; MARGIN: 30px auto; DISPLAY: block; BORDER-RIGHT-COLOR: rgb(0,0,0); LETTER-SPACING: normal; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial' border=1>
<TBODY style="BOX-SIZING: border-box">
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box"><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Number of active ALB or CLB nodes across all AZs (Result)</STRONG></TD>
<TD style="BOX-SIZING: border-box"><STRONG style='BOX-SIZING: border-box; FONT-FAMILY: AmazonEmberBold, "Helvetica Neue Bold", "Helvetica Neue", Helvetica, Arial, sans-serif; FONT-WEIGHT: 500'>Recommendation</STRONG></TD></TR>
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box">Equal to or less than 12</TD>
<TD style="BOX-SIZING: border-box">
<TABLE style="BOX-SIZING: border-box; MARGIN-BOTTOM: 30px; MARGIN-TOP: 30px">
<TBODY style="BOX-SIZING: border-box">
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box">Sharding is not needed.</TD></TR></TBODY></TABLE></TD></TR>
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box">Between 12 and 50</TD>
<TD style="BOX-SIZING: border-box">
<TABLE style="BOX-SIZING: border-box; MARGIN-BOTTOM: 30px; MARGIN-TOP: 30px">
<TBODY style="BOX-SIZING: border-box">
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box">Sharding is not needed. Continue to monitor your load balancer</TD></TR></TBODY></TABLE></TD></TR>
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box">More than 50</TD>
<TD style="BOX-SIZING: border-box">You should look at your load balancers historical traffic and determine how long it will be until it doubles, and then plan to shard at that time</TD></TR>
<TR style="BOX-SIZING: border-box">
<TD style="BOX-SIZING: border-box">Equal to or more than 99</TD>
<TD style="BOX-SIZING: border-box">You are already at the maximum number of ALB or CLB nodes, sharding is required immediately.</TD></TR></TBODY></TABLE>