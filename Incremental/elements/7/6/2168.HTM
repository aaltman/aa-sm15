<b> : </b>Throughput test<A tabIndex=-1 aria-hidden=true style="BOX-SIZING: border-box; TEXT-DECORATION: none; COLOR: rgb(37,123,215); BACKGROUND-COLOR: transparent" href="https://developer.confluent.io/learn/kafka-performance/#throughput-test" data-original-href="#throughput-test"><SPAN class=header-link style="BOX-SIZING: border-box; FONT-SIZE: 14px; MARGIN-LEFT: 5px; opacity: 0"></SPAN></A></H2>
<P style="BOX-SIZING: border-box; FONT-SIZE: 16px; FONT-FAMILY: Inter-Regular, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(21,32,43); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 15px 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">The first measurement was to determine the peak stable throughput that Kafka could achieve. Peak stable throughput is defined as the highest average producer throughput at which consumers can keep up without an ever-growing backlog.</P>
<P style="BOX-SIZING: border-box; FONT-SIZE: 16px; FONT-FAMILY: Inter-Regular, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(21,32,43); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 15px 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">The experiment was designed according to the following principles and expected guarantees:</P>
<UL style="LIST-STYLE-TYPE: disc; BOX-SIZING: border-box; FONT-SIZE: 16px; FONT-FAMILY: Inter-Regular, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; LIST-STYLE-POSITION: outside; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(21,32,43); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 0px; PADDING-LEFT: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 0px 40px; LETTER-SPACING: normal; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">
<LI style="BOX-SIZING: border-box; MARGIN: 20px 0px">Kafka was configured with<SPAN>&nbsp;</SPAN><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bolder">100 partitions</STRONG><SPAN>&nbsp;</SPAN>across one topic.</LI>
<LI style="BOX-SIZING: border-box; MARGIN: 20px 0px">Messages are<SPAN>&nbsp;</SPAN><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bolder">replicated 3x</STRONG><SPAN>&nbsp;</SPAN>for fault tolerance (see below for specific configs).</LI>
<LI style="BOX-SIZING: border-box; MARGIN: 20px 0px">Batching was enabled to optimize for throughput. Up to<SPAN>&nbsp;</SPAN><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bolder">1 MB</STRONG><SPAN>&nbsp;</SPAN>of data is batched for a maximum of<SPAN>&nbsp;</SPAN><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bolder">10 ms</STRONG>.</LI></UL>
<P style="BOX-SIZING: border-box; FONT-SIZE: 16px; FONT-FAMILY: Inter-Regular, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(21,32,43); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 15px 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">Kafka delivered high throughput, near-saturating the disk I/O available in the testbed. Given its design, each byte produced was written just once onto disk on a code path that has been optimized for almost a decade by thousands of organizations across the world.</P>
<DIV style="BOX-SIZING: border-box; FONT-SIZE: 16px; FONT-FAMILY: Inter-Regular, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(21,32,43); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><IMG style="BORDER-TOP-STYLE: none; BOX-SIZING: border-box; CURSOR: zoom-in; MAX-WIDTH: 100%; BORDER-LEFT-STYLE: none; WIDTH: auto; BORDER-BOTTOM-STYLE: none; POSITION: relative; BORDER-RIGHT-STYLE: none; LEFT: 0px; MIN-HEIGHT: 200px; MARGIN: auto; DISPLAY: block; transform: translateX(-50%)" alt="Kafka Throughput" src="https://images.contentful.com/gt6dp23g0g38/4HsVJ5JBcWi0rki2997vNV/c11ff3d6d4e2490d4b090b51edc15072/kafka-throughput-v2.png"></DIV>
<P style="BOX-SIZING: border-box; FONT-SIZE: 16px; FONT-FAMILY: Inter-Regular, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(21,32,43); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 15px 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><EM style="BOX-SIZING: border-box">Figure 2. Peak stable throughput of Kafka: 100 topic partitions with 1 KB messages, using four producers and four consumers against a three-node Kafka cluster</EM></P>
<P style="BOX-SIZING: border-box; FONT-SIZE: 16px; FONT-FAMILY: Inter-Regular, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(21,32,43); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 15px 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">Kafka was configured to use<SPAN>&nbsp;</SPAN><SPAN class=language-text style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; FONT-WEIGHT: 400; COLOR: rgb(216,54,93); PADDING-BOTTOM: 0.1em; PADDING-TOP: 0.1em; PADDING-LEFT: 0.1em; LINE-HEIGHT: 26px; PADDING-RIGHT: 0.1em; border-radius: 4px'>batch.size=1MB</SPAN><SPAN>&nbsp;</SPAN>and<SPAN>&nbsp;</SPAN><SPAN class=language-text style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; FONT-WEIGHT: 400; COLOR: rgb(216,54,93); PADDING-BOTTOM: 0.1em; PADDING-TOP: 0.1em; PADDING-LEFT: 0.1em; LINE-HEIGHT: 26px; PADDING-RIGHT: 0.1em; border-radius: 4px'>linger.ms=10</SPAN><SPAN>&nbsp;</SPAN>for the producer to effectively batch writes sent to the brokers. In addition,<SPAN>&nbsp;</SPAN><SPAN class=language-text style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; FONT-WEIGHT: 400; COLOR: rgb(216,54,93); PADDING-BOTTOM: 0.1em; PADDING-TOP: 0.1em; PADDING-LEFT: 0.1em; LINE-HEIGHT: 26px; PADDING-RIGHT: 0.1em; border-radius: 4px'>acks=all</SPAN><SPAN>&nbsp;</SPAN>was configured in the producer along with<SPAN>&nbsp;</SPAN><SPAN class=language-text style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; FONT-WEIGHT: 400; COLOR: rgb(216,54,93); PADDING-BOTTOM: 0.1em; PADDING-TOP: 0.1em; PADDING-LEFT: 0.1em; LINE-HEIGHT: 26px; PADDING-RIGHT: 0.1em; border-radius: 4px'>min.insync.replicas=2</SPAN><SPAN>&nbsp;</SPAN>to ensure every message was replicated to at least two brokers before acknowledging it back to the producer. Kafka was able to efficiently max out both the disks on each of the brokers&#8212;the ideal outcome for a storage system. See Kafka's<SPAN>&nbsp;</SPAN><A style="BOX-SIZING: border-box; TEXT-DECORATION: none; COLOR: rgb(37,123,215); BACKGROUND-COLOR: transparent" href="https://github.com/confluentinc/openmessaging-benchmark/blob/master/driver-kafka/kafka-group-all.yaml" rel="nofollow noopener noreferrer" target=_blank data-original-href="https://github.com/confluentinc/openmessaging-benchmark/blob/master/driver-kafka/kafka-group-all.yaml">driver configuration</A><SPAN>&nbsp;</SPAN>for details.</P>
<DIV style="BOX-SIZING: border-box; FONT-SIZE: 16px; FONT-FAMILY: Inter-Regular, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(21,32,43); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><IMG style="BORDER-TOP-STYLE: none; BOX-SIZING: border-box; CURSOR: zoom-in; MAX-WIDTH: 100%; BORDER-LEFT-STYLE: none; HEIGHT: auto; MIN-WIDTH: 250px; BORDER-BOTTOM-STYLE: none; POSITION: relative; BORDER-RIGHT-STYLE: none; LEFT: 0px; MARGIN: auto; DISPLAY: block; transform: translateX(-50%)" alt="Kafka Producer/Consumer Throughput" src="https://images.contentful.com/gt6dp23g0g38/4TAQDRZUX42aI4DFfFp4Um/e39cafd87fba7f8aab5ee6795b79e3fe/unnamed-7.png"></DIV>
<P style="BOX-SIZING: border-box; FONT-SIZE: 16px; FONT-FAMILY: Inter-Regular, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(21,32,43); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 15px 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><EM style="BOX-SIZING: border-box">Figure 3. The graph shows I/O utilization on Kafka brokers and the corresponding producer/consumer throughput (source: Prometheus node metrics). See<SPAN>&nbsp;</SPAN><A style="BOX-SIZING: border-box; TEXT-DECORATION: none; COLOR: rgb(37,123,215); BACKGROUND-COLOR: transparent" href="https://github.com/confluentinc/openmessaging-benchmark/blob/master/blog/results/kafka/throughput/default-sync.json" rel="nofollow noopener noreferrer" target=_blank data-original-href="https://github.com/confluentinc/openmessaging-benchmark/blob/master/blog/results/kafka/throughput/default-sync.json">raw results</A><SPAN>&nbsp;</SPAN>for details.</EM>