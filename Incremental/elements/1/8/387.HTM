<b> : </b>Read-Ahead Tuning<A title="Permanent link" class=headerlink style="TEXT-DECORATION: none; COLOR: ; DISPLAY: inline-block; -webkit-tap-highlight-color: transparent; transition: transform 0.25s 0.25s, color 0.25s, opacity 0.125s 0.25s, -webkit-transform 0.25s 0.25s; transform: translateY(0.25rem); opacity: 0" href="https://kb.techtaco.org/linux/postgresql/postgresql_file_system_tuning/#read-ahead-tuning">&#182;</A></H2>
<P style='FONT-SIZE: 16px; FONT-FAMILY: Roboto, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: ; FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 1em 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>This feature results in asking for blocks form the disk ahead of the application requesting them. You can check your current read-ahead using the blockdev command, either for a single drive or with a summary for all drives, RAID devices, and logical volumes. The default is 256 for regular drives, and may be larger for software RAID devices. The units here are normally 512 bytes, making the default value equal to 128KB of read-ahead.</P>
<DIV id=__code_0 class=codehilite style='FONT-SIZE: 16px; FONT-FAMILY: Roboto, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; POSITION: relative; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(55,71,79); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 0px; PADDING-LEFT: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 1em 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.4; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; border-radius: 0.1rem'><PRE style='FONT-SIZE: 13px; OVERFLOW: auto; FONT-FAMILY: "Roboto Mono", "Courier New", Courier, monospace; VERTICAL-ALIGN: top; POSITION: relative; COLOR: rgb(55,71,79); DIRECTION: ltr; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; DISPLAY: block; LINE-HEIGHT: 1.4; PADDING-RIGHT: 0px; BACKGROUND-COLOR: transparent; border-radius: 0.1rem; font-feature-settings: "kern"'><SPAN></SPAN>blockdev --getra /dev/sda
blockdev --report
</PRE></DIV>
<P style='FONT-SIZE: 16px; FONT-FAMILY: Roboto, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: ; FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 1em 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>The normal properly tuned range on modern hardware normally works out to be 4096 to 16384. You can make the change via the blockdev command. Unfortunatley, read-ahead needs to be set for each drive on your system. It's usually handled by putting a blockdev adjustement for each device in rc.local boot script.</P>
<DIV id=__code_1 class=codehilite style='FONT-SIZE: 16px; FONT-FAMILY: Roboto, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; POSITION: relative; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(55,71,79); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 0px; PADDING-LEFT: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 1em 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.4; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; border-radius: 0.1rem'><PRE style='FONT-SIZE: 13px; OVERFLOW: auto; FONT-FAMILY: "Roboto Mono", "Courier New", Courier, monospace; VERTICAL-ALIGN: top; POSITION: relative; COLOR: rgb(55,71,79); DIRECTION: ltr; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; DISPLAY: block; LINE-HEIGHT: 1.4; PADDING-RIGHT: 0px; BACKGROUND-COLOR: transparent; border-radius: 0.1rem; font-feature-settings: "kern"'><SPAN></SPAN>blockdev --setra <SPAN class=m style="COLOR: rgb(231,76,60)">4096</SPAN> /dev/sda
</PRE></DIV>
<P style='FONT-SIZE: 16px; FONT-FAMILY: Roboto, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: ; FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 1em 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>If you run bonnie++ with a few read-ahead values, you should see the sequential read numbers increase as you tune upwards, eventually leveling off. On smaller disk arrays or single drives, the difference may not be large. Using this amount of read-ahead is necessary to reach full speed on a larger disk array.