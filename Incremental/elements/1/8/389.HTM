<b> : </b>Write Barrier Tuning<A title="Permanent link" class=headerlink style="TEXT-DECORATION: none; COLOR: ; DISPLAY: inline-block; -webkit-tap-highlight-color: transparent; transition: transform 0.25s 0.25s, color 0.25s, opacity 0.125s 0.25s, -webkit-transform 0.25s 0.25s; transform: translateY(0.25rem); opacity: 0" href="https://kb.techtaco.org/linux/postgresql/postgresql_file_system_tuning/#write-barrier-tuning">&#182;</A></H2>
<P style='FONT-SIZE: 16px; FONT-FAMILY: Roboto, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: ; FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 1em 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>When PostgreSQL writes to disk, it executes one of the system fsync calls (fsync or fdatasync) to flush that data to disk. By default, the cache on hard disks and disk controllers are assumed to be volatile: when power fails, data written there will be lost. Since that can result in filesystem and/or database corruption when it happens, fsync in Linux issues a write barrier that forces all data onto physical disk. That will flush the write cache on both RAID and drive write caches.</P>
<P style='FONT-SIZE: 16px; FONT-FAMILY: Roboto, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: ; FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 1em 0px; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>When the database hardware includes a battery-backed write that's setup correctly, this is not necessary. Writes to that cache are not volatile; they will be saved in the case of a power interruption. In that case, you can turn off barriers on that disk. This results in a significant boost in write performance. You can disable barriers on the database volume by adding nobarrier to the volume mount options in /etc/fstab.</P>
<DIV id=__code_3 class=codehilite style='FONT-SIZE: 16px; FONT-FAMILY: Roboto, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; POSITION: relative; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(55,71,79); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 0px; PADDING-LEFT: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 1em 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.4; PADDING-RIGHT: 0px; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; border-radius: 0.1rem'><PRE style='FONT-SIZE: 13px; OVERFLOW: auto; FONT-FAMILY: "Roboto Mono", "Courier New", Courier, monospace; VERTICAL-ALIGN: top; POSITION: relative; COLOR: rgb(55,71,79); DIRECTION: ltr; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; DISPLAY: block; LINE-HEIGHT: 1.4; PADDING-RIGHT: 0px; BACKGROUND-COLOR: transparent; border-radius: 0.1rem; font-feature-settings: "kern"'><SPAN></SPAN>/dev/sda1 /pgsql ext4 noatime,nobarrier,errors<SPAN class=o style="COLOR: ">=</SPAN>remount-ro <SPAN class=m style="COLOR: rgb(231,76,60)">0</SPAN> <SPAN class=m style="COLOR: rgb(231,76,60)">1</SPAN>
</PRE></DIV>