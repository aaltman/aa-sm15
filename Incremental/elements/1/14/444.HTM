<H2 id=what-is-partitioning style='BOX-SIZING: border-box; FONT-SIZE: 24px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.2; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>What is partitioning in Postgres?</FONT></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://www.postgresql.org/docs/current/ddl-partitioning.html" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>Table partitioning in Postgres</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>is:</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<UL style='BOX-SIZING: border-box; FONT-SIZE: 16px; MARGIN-BOTTOM: 12px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 0px; LIST-STYLE-POSITION: outside; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-LEFT: 2.5em; CLEAR: left; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>A built-in, native feature in Postgres </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Some people refer to it as &#8220;declarative partitioning&#8221; since you have to declare whether you mean to<SPAN>&nbsp;</SPAN><CODE style='BOX-SIZING: border-box; FONT-SIZE: 12px; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; COLOR: black; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(249,242,244); border-radius: 4px'>PARTITION BY RANGE</CODE><SPAN>&nbsp;</SPAN>or<SPAN>&nbsp;</SPAN><CODE style='BOX-SIZING: border-box; FONT-SIZE: 12px; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; COLOR: black; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(249,242,244); border-radius: 4px'>PARTITION BY LIST</CODE><SPAN>&nbsp;</SPAN>or<SPAN>&nbsp;</SPAN><CODE style='BOX-SIZING: border-box; FONT-SIZE: 12px; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; COLOR: black; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(249,242,244); border-radius: 4px'>PARTITION BY HASH</CODE><SPAN>&nbsp;</SPAN>when you are creating the table </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Splits large tables into many smaller tables (&#8220;partitions&#8221;)&#8212;which can benefit you in terms of performance, since it&#8217;s more efficient to work with smaller chunks of data </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>While most tables probably don&#8217;t need to be partitioned, and<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://brandur.org/fragments/postgres-partitioning-2022" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>per Brandur&#8217;s footnote advice</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>you shouldn&#8217;t use this feature for no reason... partitioning has improved quite a bit in Postgres in recent years and can be useful for scaling performance on a single Postgres node. </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Needs to be declared up front when you first create a Postgres table, since you can&#8217;t turn an existing regular Postgres table into a partitioned table without a significant amount of data rewriting.</FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://techcommunity.microsoft.com/t5/azure-database-for-postgresql/understanding-partitioning-and-sharding-in-postgres-and-citus/ba-p/3891629#fn1" name=fnref1 rel="nofollow noopener noreferrer" target=_self><FONT class=extract>[1]</FONT></A></LI></UL>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<H2 id=partitioning-benefit style='BOX-SIZING: border-box; FONT-SIZE: 24px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.2; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>How Postgres partitioning can benefit you</FONT></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>By far the most common use case for partitioning is to partition tables containing time series data by time (e.g. typically a partition per or week). That has several key benefits:</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<UL style='BOX-SIZING: border-box; FONT-SIZE: 16px; MARGIN-BOTTOM: 12px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 0px; LIST-STYLE-POSITION: outside; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-LEFT: 2.5em; CLEAR: left; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold">Improves query performance:</STRONG><SPAN>&nbsp;</SPAN>particularly when you query a subset of partitions (e.g. recent data) and the partitions you&#8217;re querying can be held in memory </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold">Improves performance of bulk deletes</STRONG><SPAN>&nbsp;</SPAN>if the data you&#8217;re expiring is associated with older partitions, so you can avoid having to scan the table, table bloat, and fragmentation by simply dropping the old partitions. </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold">Improves performance of autovacuum</STRONG>, since it can run in parallel on the partitions and avoids the &#8220;autovacuum can&#8217;t keep up&#8221; problem. </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold">Storage cost optimization:</STRONG><SPAN>&nbsp;</SPAN>Perhaps you want to put some partitions on different storage (maybe you have a table space for big slow disks for seldom-used and older data, and fast expensive storage for currently active partitions.) </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold">Compression:</STRONG><SPAN>&nbsp;</SPAN>Perhaps you want to use a different Postgres table access method for some data: data that is still changing can be in regular row format, and older data can move into (say)<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://docs.citusdata.com/en/stable/admin_guide/table_management.html#columnar-storage" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>Citus columnar</FONT></A><FONT class=extract>.</FONT></LI></UL>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>There are other cases in which you might want to use partitioning, especially if you are suffering from autovacuuming issues, though time series is the most common.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<H3 id=toc-hId--549600637 style='BOX-SIZING: border-box; FONT-SIZE: 18px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 0.5em; LETTER-SPACING: normal; LINE-HEIGHT: 1.2; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>One of my favorite blog posts about Postgres partitioning</FONT></H3>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Prior to this PGSQL Phriday blogging event on partitioning vs. sharding, one of my<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://brandur.org/fragments/postgres-partitioning-2022" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>favorite Postgres partitioning blog posts</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>was this one by Brandur. I love his description of Postgres partitioned tables:</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<BLOCKQUOTE style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0px; FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 24px; BORDER-LEFT: rgb(232,232,232) 5px solid; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 24px; LETTER-SPACING: normal; LINE-HEIGHT: 1.7142; PADDING-RIGHT: 24px; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; opacity: 0.8'>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; MARGIN: 0px'><FONT class=extract>&#8220;Partitioned tables aren&#8217;t an everyday go to, but are invaluable in some cases, particularly when you have a high volume table that&#8217;s expected to keep growing.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; MARGIN: 0px'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; MARGIN: 0px'><FONT class=extract>In Postgres, trying to remove old rows from a large, hot table is flitting with disaster. A long running query must iterate through and mark each one as dead, and even then nothing is reclaimed until an equally expensive vacuum runs through and frees space, and only when it&#8217;s allowed to after rows are no longer visible to any other query in the system, whether they&#8217;re making use of the large table or not. Each row removal land in the WAL, resulting in significant amplification.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; MARGIN: 0px'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; MARGIN: 0px'><FONT class=extract>But with partitions, deletion becomes a simple DROP TABLE. It executes instantly, and with negligible costs (partitioning has other benefits too). The trade-off is maintenance.&#8221;</FONT></P></BLOCKQUOTE>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<H2 id=what-is-sharding style='BOX-SIZING: border-box; FONT-SIZE: 24px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.2; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>What is sharding in Postgres?</FONT></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Sharding in Postgres is:</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<UL style='BOX-SIZING: border-box; FONT-SIZE: 16px; MARGIN-BOTTOM: 12px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 0px; LIST-STYLE-POSITION: outside; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-LEFT: 2.5em; CLEAR: left; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>a technique of splitting Postgres database tables into smaller tables (called &#8220;shards&#8221;) that is typically used to distribute data horizontally across multiple nodes comprising a cluster of database instances </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>a capability available via the<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://github.com/citusdata/citus" rel="noopener noreferrer" target=_blank><FONT class=extract>Citus open source extension</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>to Postgres </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>typically deployed in a multi-node cluster</FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://techcommunity.microsoft.com/t5/azure-database-for-postgresql/understanding-partitioning-and-sharding-in-postgres-and-citus/ba-p/3891629#fn2" name=fnref2 rel="nofollow noopener noreferrer" target=_self><FONT class=extract>[2]</FONT></A><FONT class=extract> </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>can be thought of as &#8220;horizontal scaling&#8221; since you&#8217;re distributing Postgres across nodes in a cluster</FONT></LI></UL>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Some people associate the term sharding with the idea of &#8220;manual sharding&#8221; or what I call &#8220;sharding at the application level.&#8221; Many of you likely know that application-level sharding is a LOT of work, since your application needs to keep track of which shards are where in order to know which nodes to query. That&#8217;s not what I&#8217;m talking about with Citus and Postgres.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>With the Citus extension to Postgres, all the sharding metadata (such as which shard is on which node) is managed and maintained by Citus, which means your application can remain blissfully ignorant of the fact that it is running on top of a Postgres cluster and you can let Citus take care of the sharding management.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Of course, that&#8217;s not to say that _you_ can completely ignore the fact that your app is running on top of distributed Postgres. You&#8217;ll still need to decide up-front what tables (or schemas) to distribute across the cluster, and which tables you might leave as regular Postgres tables on the coordinator, and which tables would make good reference tables. And you&#8217;ll likely need to add nodes to your cluster as you scale and grow, rebalance shards to balance performance, and perhaps even isolate big tenants if you&#8217;re running a multi-tenant SaaS application. Basically, you&#8217;ll have to do things to optimize the cluster as your workload grows.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<H2 id=when-to-use-citus style='BOX-SIZING: border-box; FONT-SIZE: 24px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.2; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>When to use Citus to shard Postgres?</FONT></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<UL style='BOX-SIZING: border-box; FONT-SIZE: 16px; MARGIN-BOTTOM: 12px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 0px; LIST-STYLE-POSITION: outside; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-LEFT: 2.5em; CLEAR: left; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>The traditional<SPAN>&nbsp;</SPAN><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold">&#8220;row-based&#8221; Citus sharding</STRONG><SPAN>&nbsp;</SPAN>approach for Postgres is a good fit for real-time analytics apps including: </FONT>
<UL style="BOX-SIZING: border-box; MARGIN-BOTTOM: 0px; MARGIN-TOP: 0px; LIST-STYLE-POSITION: outside; PADDING-LEFT: 2.5em; CLEAR: left">
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>time series applications, </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>IOT applications that need UPDATEs and JOINs, </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>HTAP applications with mixed transactional and analytics workloads, </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>high-throughput transactional apps, and </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>multi-tenant SaaS apps that have a very large number of tenants (think: B2C apps with more than 100K tenants)<BR style="BOX-SIZING: border-box"><BR style="BOX-SIZING: border-box"></FONT></LI></UL>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>The Citus<SPAN>&nbsp;</SPAN><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold">&#8220;schema-based sharding&#8221;<SPAN>&nbsp;</SPAN></STRONG>approach&#8212;</FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://www.citusdata.com/blog/2023/07/18/citus-12-schema-based-sharding-for-postgres/" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>newly-introduced in Citus 12.0</FONT></A><FONT class=extract>&#8212;is a good fit for: </FONT>
<UL style="BOX-SIZING: border-box; MARGIN-BOTTOM: 0px; MARGIN-TOP: 0px; LIST-STYLE-POSITION: outside; PADDING-LEFT: 2.5em; CLEAR: left">
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>multi-tenant SaaS apps with fewer than 10K tenants (think: B2B) </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>microservices applications. </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>vertical partitioning of complex applications by function </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>complex OLTP applications that can be vertically sharded by function<BR style="BOX-SIZING: border-box"><BR style="BOX-SIZING: border-box"></FONT></LI></UL></LI></UL>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>As a developer, schema-based sharding is a bit easier to get started with since you do not need to choose a distribution key or make any changes to your data model to ensure that the distribution column is in your tables. Rather, with Citus schema-based sharding, you can leverage the existing Postgres schemas you&#8217;ve defined for your database to distribute Postgres across multiple nodes.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<H3 id=toc-hId--1676996730 style='BOX-SIZING: border-box; FONT-SIZE: 18px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 0.5em; LETTER-SPACING: normal; LINE-HEIGHT: 1.2; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>How can sharding Postgres with Citus benefit you?</FONT></H3>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>The reason to shard Postgres with Citus pretty much always comes down to needing<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://www.citusdata.com/blog/2023/06/21/distributed-postgres-benchmarks-using-hammerdb-by-gigaom/" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>more performance</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>and more scale than you can eek out on a single node&#8212;even a really freaking big single node. I wrote this in a blog post back in late 2020 and it&#8217;s still true:</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<BLOCKQUOTE style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0px; FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-TOP: 0px; PADDING-LEFT: 24px; BORDER-LEFT: rgb(232,232,232) 5px solid; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px 0px 24px; LETTER-SPACING: normal; LINE-HEIGHT: 1.7142; PADDING-RIGHT: 24px; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; opacity: 0.8'>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; MARGIN: 0px'><FONT class=extract>Why would you want to use Citus to shard Postgres?</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; MARGIN: 0px'><FONT class=extract>&nbsp;</FONT></P>
<UL style="BOX-SIZING: border-box; MARGIN-BOTTOM: 0px; MARGIN-TOP: 0px; LIST-STYLE-POSITION: outside; PADDING-LEFT: 2.5em; CLEAR: left">
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold">Performance:</STRONG><SPAN>&nbsp;</SPAN>Because your single node Postgres is not performant enough and cannot keep up with the peaks in your workload. </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold">Scale:</STRONG><SPAN>&nbsp;</SPAN>Because your application is growing fast and you want to prepare your Postgres deployment to scale out before you run into performance issues, before you have to send your customers apology letters for poor performance.</FONT></LI></UL></BLOCKQUOTE>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Since sharding is inherently also a form of hash-partitioning, some of the performance benefits of partitioning also apply to sharding. In particular, autovacuum runs in parallel across all the Citus shards in the cluster.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<H2 id=partitioning-vs-sharding style='BOX-SIZING: border-box; FONT-SIZE: 24px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.2; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Partitioning vs. Sharding, a side-by-side comparison table</FONT></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<TABLE style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; BORDER-COLLAPSE: collapse; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; BORDER-SPACING: 0px; ORPHANS: 2; WIDOWS: 2; MARGIN: 15px 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<THEAD style="BOX-SIZING: border-box">
<TR style="BOX-SIZING: border-box">
<TH style="BOX-SIZING: border-box; BORDER-TOP: rgb(221,221,221) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; BORDER-BOTTOM: rgb(221,221,221) 1px solid; PADDING-BOTTOM: 10px; TEXT-ALIGN: left; PADDING-TOP: 10px; PADDING-LEFT: 10px; BORDER-LEFT: rgb(221,221,221) 1px solid; PADDING-RIGHT: 10px; BACKGROUND-COLOR: rgb(238,238,238)"><FONT class=extract>&nbsp;</FONT></TH>
<TH style="BOX-SIZING: border-box; BORDER-TOP: rgb(221,221,221) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; WIDTH: 261px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; BACKGROUND-COLOR: rgb(238,238,238); border-image: initial"><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold"><FONT class=extract>Partitioning in Postgres</FONT></STRONG></TH>
<TH style="BOX-SIZING: border-box; BORDER-TOP: rgb(221,221,221) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; WIDTH: 261px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; BACKGROUND-COLOR: rgb(238,238,238); border-image: initial"><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold"><FONT class=extract>Sharding in Postgres</FONT></STRONG></TH></TR></THEAD>
<TBODY style="BOX-SIZING: border-box">
<TR style="BOX-SIZING: border-box">
<TH style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; BORDER-BOTTOM: rgb(221,221,221) 1px solid; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: left; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(221,221,221) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold"><FONT class=extract>Feature availability</FONT></STRONG></TH>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Built-in, native support in Postgres</FONT></TD>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Available via Citus extension to Postgres</FONT></TD></TR>
<TR style="BOX-SIZING: border-box">
<TH style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; BORDER-BOTTOM: rgb(221,221,221) 1px solid; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: left; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(221,221,221) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold"><FONT class=extract># of nodes</FONT></STRONG></TH>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Single node</FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://techcommunity.microsoft.com/t5/azure-database-for-postgresql/understanding-partitioning-and-sharding-in-postgres-and-citus/ba-p/3891629#fn3" name=fnref3 rel="nofollow noopener noreferrer" target=_self><SPAN style='BOX-SIZING: border-box; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>[3]</FONT></SPAN></A></TD>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Typically a multi-node cluster</FONT></TD></TR>
<TR style="BOX-SIZING: border-box">
<TH style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; BORDER-BOTTOM: rgb(221,221,221) 1px solid; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: left; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(221,221,221) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold"><FONT class=extract>Types</FONT></STRONG></TH>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>RANGE, LIST, &amp; HASH</FONT></TD>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Row-based (hash) &amp; schema-based</FONT></TD></TR>
<TR style="BOX-SIZING: border-box">
<TH style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; BORDER-BOTTOM: rgb(221,221,221) 1px solid; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: left; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(221,221,221) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold"><FONT class=extract>Good fit for</FONT></STRONG></TH>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Time series<BR style="BOX-SIZING: border-box">IoT<BR style="BOX-SIZING: border-box">Real-time analytics</FONT></TD>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Time series<BR style="BOX-SIZING: border-box">Real-time analytics<BR style="BOX-SIZING: border-box">Multi-tenant applications<BR style="BOX-SIZING: border-box">Microservices<BR style="BOX-SIZING: border-box">High throughput CRUD<BR style="BOX-SIZING: border-box">...</FONT></TD></TR>
<TR style="BOX-SIZING: border-box">
<TH style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; BORDER-BOTTOM: rgb(221,221,221) 1px solid; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: left; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(221,221,221) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold"><FONT class=extract>Shard/partition maintenance</FONT></STRONG></TH>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Manual (use additional tools)</FONT></TD>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Automatic / transparent</FONT></TD></TR>
<TR style="BOX-SIZING: border-box">
<TH style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; BORDER-BOTTOM: rgb(221,221,221) 1px solid; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: left; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(221,221,221) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold"><FONT class=extract>Unique capabilities</FONT></STRONG></TH>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Drop old data quickly<BR style="BOX-SIZING: border-box">Compress old data</FONT></TD>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Horizontal scale out of hardware<BR style="BOX-SIZING: border-box">Parallel, distributed SQL/DML/DDL</FONT></TD></TR>
<TR style="BOX-SIZING: border-box">
<TH style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; BORDER-BOTTOM: rgb(221,221,221) 1px solid; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: left; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(221,221,221) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><STRONG style="BOX-SIZING: border-box; FONT-WEIGHT: bold"><FONT class=extract>Other benefits</FONT></STRONG></TH>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Read only relevant partitions<BR style="BOX-SIZING: border-box">Parallel autovacuum<BR style="BOX-SIZING: border-box">Better index cache hit ratios</FONT></TD>
<TD style="BOX-SIZING: border-box; BORDER-TOP: rgb(209,209,209) 1px solid; BORDER-RIGHT: rgb(221,221,221) 1px solid; MIN-WIDTH: 40px; BORDER-BOTTOM: rgb(221,221,221) 1px solid; WORD-BREAK: normal; PADDING-BOTTOM: 0.5em !important; TEXT-ALIGN: center; PADDING-TOP: 0.5em !important; PADDING-LEFT: 0.5em !important; BORDER-LEFT: rgb(209,209,209) 1px solid; PADDING-RIGHT: 0.5em !important; border-image: initial"><FONT class=extract>Read only relevant shards<BR style="BOX-SIZING: border-box">Parallel, distributed autovacuum<BR style="BOX-SIZING: border-box">Data rebalancing across nodes</FONT></TD></TR></TBODY></TABLE>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<H2 id=time-series style='BOX-SIZING: border-box; FONT-SIZE: 24px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.2; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>How to use range partitioning &amp; Citus sharding together for time series</FONT></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>If you work on an application that deals with time series data, specifically append-mostly time series data, you&#8217;ll likely find this post about<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://www.citusdata.com/blog/2021/10/22/how-to-scale-postgres-for-time-series-data-with-citus/" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>using Postgres range partitioning and Citus sharding together</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>to scale time series workloads to be useful additional reading.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>The time series post covers:</FONT></P>
<UL style='BOX-SIZING: border-box; FONT-SIZE: 16px; MARGIN-BOTTOM: 12px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 0px; LIST-STYLE-POSITION: outside; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-LEFT: 2.5em; CLEAR: left; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Built-in Postgres partitioning </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Citus UDFs that simplify partition management:<SPAN>&nbsp;</SPAN><CODE style='BOX-SIZING: border-box; FONT-SIZE: 12px; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; COLOR: black; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(249,242,244); border-radius: 4px'>create_time_partitions</CODE><SPAN>&nbsp;</SPAN>and<SPAN>&nbsp;</SPAN><CODE style='BOX-SIZING: border-box; FONT-SIZE: 12px; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; COLOR: black; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(249,242,244); border-radius: 4px'>drop_old_time_partitions</CODE> </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Compression (if you use<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://docs.citusdata.com/en/stable/admin_guide/table_management.html#columnar-storage" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>Citus columnar</FONT></A><FONT class=extract>) </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Automation via<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://github.com/citusdata/pg_cron" rel="noopener noreferrer" target=_blank><FONT class=extract>pg_cron</FONT></A><FONT class=extract> </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Sharding &amp; distributing across nodes with Citus</FONT></LI></UL>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>The bottom line of the<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://www.citusdata.com/blog/2021/10/22/how-to-scale-postgres-for-time-series-data-with-citus/" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>time series blog post</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>is that you can use Postgres built-in range partitioning to partition your tables by time ranges (super useful for time series data) and then&#8212;assuming your application needs more cpu and memory than you can get on a single node&#8212;you can also use Citus database sharding to distribute sharded partitions across a multi-node cluster.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><SPAN class="lia-inline-image-display-wrapper lia-image-align-inline" style='BOX-SIZING: border-box; MAX-WIDTH: 100%; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WIDTH: 999px; POSITION: relative; DISPLAY: inline-block' image-alt="Figure 1: This diagram shows how you can use Postgres partitioning and sharding together for applications (such as time series) that can benefit from partitioning data BY RANGE and sharding those time-partitions across a multi-node cluster."><SPAN class="lia-message-image-wrapper lia-message-image-actions-narrow lia-message-image-actions-below" style='BOX-SIZING: border-box; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract><IMG role=button tabIndex=0 class=lia-media-image style="BOX-SIZING: border-box; CURSOR: zoom-in; MAX-WIDTH: 100%; BORDER-TOP: 0px; HEIGHT: auto; BORDER-RIGHT: 0px; VERTICAL-ALIGN: middle; BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; DISPLAY: block" alt="thumbnail image 1 captioned Figure 1: This diagram shows how you can use Postgres partitioning and sharding together for applications (such as time series) that can benefit from partitioning data BY RANGE and sharding those time-partitions across a multi-node cluster." src="https://techcommunity.microsoft.com/t5/image/serverpage/image-id/495236iEA590C00DA7A1DDB/image-size/large?v=v2&amp;px=999" li-image-url="https://techcommunity.microsoft.com/t5/image/serverpage/image-id/495236iEA590C00DA7A1DDB?v=v2" li-image-display-id="'495236iEA590C00DA7A1DDB'" li-message-uid="'3891629'" li-messages-message-image="true" li-bindable="" li-bypass-lightbox-when-linked="true" li-use-hover-links="false" li-compiled="true"></FONT></SPAN><SPAN class=lia-inline-image-caption style='BOX-SIZING: border-box; FONT-SIZE: 14px; CURSOR: text; HEIGHT: auto; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; COLOR: rgb(102,102,102); FONT-STYLE: italic; TEXT-ALIGN: left; MARGIN: 10px 0px 20px; DISPLAY: block'><FONT class=extract>Figure 1: This diagram shows how you can use Postgres partitioning and sharding together for applications (such as time series) that can benefit from partitioning data BY RANGE and sharding those time-partitions across a multi-node cluster.</FONT></SPAN></SPAN></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<H2 id=postgres_fdw style='BOX-SIZING: border-box; FONT-SIZE: 24px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.2; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>What about sharding using partitioned tables with postgres_fdw?</FONT></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>An alternative approach to sharding Postgres using Citus is to create a hash-partitioned table in Postgres in which every partition is a foreign table that uses<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://www.postgresql.org/docs/current/postgres-fdw.html" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>postgres_fdw</FONT></A><FONT class=extract>. That way, you can query tables across multiple PostgreSQL servers, and queries for a specific partition key value will only access one remote PostgreSQL server.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>While this approach has the advantage of being part of core PostgreSQL, it lacks many of the elemental features that a Postgres sharding solution needs, both in terms of management and performance. For instance:</FONT></P>
<UL style='BOX-SIZING: border-box; FONT-SIZE: 16px; MARGIN-BOTTOM: 12px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 0px; LIST-STYLE-POSITION: outside; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-LEFT: 2.5em; CLEAR: left; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>No full query pushdown (necessary to achieve scalability) </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>No transparent schema changes </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>No rebalancing </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>No reference tables </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>No co-located joins </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>No multi-stage query execution (e.g. broadcast results of CTE, then join with the CTE) </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>No object propagation (e.g. create type) </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>No shard splits </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>No pg_dump </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>No support for 2PC &#8211; cross-shard changes may only be partially applied </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Limited support for parallel query </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Poor query performance </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Poor bulk loading performance </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><FONT class=extract>Manual creation of shards</FONT></LI></UL>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>In that sense, Postgres native partitioning that uses FOREIGN TABLES to shard is effectively manual sharding with the ability to do simple queries across nodes. If you are considering using partitioning with foreign tables for sharding, we recommend you look into<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://github.com/citusdata/citus" rel="noopener noreferrer" target=_blank><FONT class=extract>Citus</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>as well.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<H2 id=toc-hId-1480071369 style='BOX-SIZING: border-box; FONT-SIZE: 24px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; LINE-HEIGHT: 1.2; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Big thank you to PGSQL Phriday blog event organizers</FONT></H2>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>+1 to Ryan Booz for organizing the<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://www.pgsqlphriday.com/" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>#PGSQLPhriday community blogging initiative</FONT></A><FONT class=extract>&#8212;and to Tomasz Gintowt for<SPAN>&nbsp;</SPAN></FONT><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://tomasz-gintowt.medium.com/pgsql-phriday-011-partitioning-vs-sharding-in-postgresql-d9c44d900429" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>hosting this month&#8217;s #PGSQL Phriday #011 event</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>and selecting the topic of &#8220;Partitioning vs. Sharding&#8221;, a topic I know and love. Like many of you, I&#8217;m looking forward to reading more of the Postgres partitioning and sharding blogs on this topic that get published.</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>&nbsp;</FONT></P>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>If you want to learn more about partitioning in Postgres and sharding Postgres with Citus, here are some links:</FONT></P>
<UL style='BOX-SIZING: border-box; FONT-SIZE: 16px; MARGIN-BOTTOM: 12px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; MARGIN-TOP: 0px; LIST-STYLE-POSITION: outside; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; PADDING-LEFT: 2.5em; CLEAR: left; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://www.postgresql.org/docs/current/ddl-partitioning.html" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>Postgres docs on table partitioning</FONT></A><FONT class=extract> </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://brandur.org/fragments/postgres-partitioning-2022" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>Partitioning in Postgres, 2022 edition</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>by Brandur </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://github.com/citusdata/citus" rel="noopener noreferrer" target=_blank><FONT class=extract>Citus open source repo</FONT></A><FONT class=extract><SPAN>&nbsp;</SPAN>on GitHub, the place to file issues or start discussions (or give a star :) </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://docs.citusdata.com/" rel="noopener nofollow noreferrer" target=_blank><FONT class=extract>Citus open source docs</FONT></A><FONT class=extract> </FONT>
<LI style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif'><A style="BOX-SIZING: border-box; TEXT-DECORATION: underline; COLOR: rgb(20,108,172); BACKGROUND-COLOR: transparent" href="https://learn.microsoft.com/azure/cosmos-db/postgresql/introduction" rel="noopener noreferrer" target=_blank><FONT class=extract>Citus on Azure docs</FONT></A><FONT class=extract>, now known as Azure Cosmos DB for PostgreSQL</FONT></LI></UL>
<P style='BOX-SIZING: border-box; FONT-SIZE: 14px; FONT-FAMILY: SegoeUI, Lato, "Helvetica Neue", Helvetica, Arial, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 300; COLOR: rgb(51,51,51); FONT-STYLE: normal; TEXT-ALIGN: left; ORPHANS: 2; WIDOWS: 2; MARGIN: 0px; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial'><FONT class=extract>Also, big thanks to Thomas Munro, Marco Slot, and Rob Treat for their thoughtful feedback on earlier drafts of this blog post. I really appreciate your inputs! And to Andreas Scherbaum for making sure this PGSQL Phriday was on my post-vacation radar.&nbsp;</FONT>