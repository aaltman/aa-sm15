<P style="FONT-SIZE: medium; FONT-FAMILY: Georgia, Cambria, serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(16,16,16); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(249,249,249); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">When a single query is run outside of a transaction block, it is clear how transaction visibility should behave &#8212; only transactions committed before the query started should be visible. Changes made by other sessions during the query, even if committed during the query, should not be visible. Slide 11 of my<SPAN>&nbsp;</SPAN><A class=txt2html style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(34,102,34) 1px dotted; COLOR: rgb(34,102,34); PADDING-BOTTOM: 0px" href="https://momjian.us/main/presentations/internals.html#mvcc"><EM>MVCC Unmasked</EM></A><SPAN>&nbsp;</SPAN>presentation illustrates this.</P>
<P style="FONT-SIZE: medium; FONT-FAMILY: Georgia, Cambria, serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(16,16,16); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(249,249,249); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">For queries run in transaction blocks, the ideal behavior is less clear, so Postgres supports three options for controlling transaction block behavior. The default,<SPAN>&nbsp;</SPAN><SPAN style="FONT-VARIANT: small-caps"><A class=txt2html style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(34,102,34) 1px dotted; COLOR: rgb(34,102,34); PADDING-BOTTOM: 0px" href="https://www.postgresql.org/docs/current/transaction-iso.html#XACT-READ-COMMITTED">read committed,</A></SPAN><SPAN>&nbsp;</SPAN>causes each new query in a transaction block to get a new visibility snapshot, meaning that each new query sees changes that were committed by other sessions before the query started.</P>
<P style="FONT-SIZE: medium; FONT-FAMILY: Georgia, Cambria, serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(16,16,16); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(249,249,249); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">This might not be ideal, so Postgres supports<SPAN>&nbsp;</SPAN><SPAN style="FONT-VARIANT: small-caps"><A class=txt2html style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(34,102,34) 1px dotted; COLOR: rgb(34,102,34); PADDING-BOTTOM: 0px" href="https://www.postgresql.org/docs/current/transaction-iso.html#XACT-REPEATABLE-READ">repeatable read.</A></SPAN><SPAN>&nbsp;</SPAN>In this mode, instead of getting a new snapshot at the start of each query in a transaction block, a snapshot is taken when the first query in the transaction block is issued, and this snapshot is used for<SPAN>&nbsp;</SPAN><EM>all</EM><SPAN>&nbsp;</SPAN>queries in the transaction block. This means that changes committed by other sessions during the transaction block's execution are not seen by any statements in the block. This is ideal for read-only transactions, such as those used for reporting. It guarantees that all statements see a consistent view of the database.</P>
<P style="FONT-SIZE: medium; FONT-FAMILY: Georgia, Cambria, serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(16,16,16); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(249,249,249); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">The third supported isolation level is the<SPAN>&nbsp;</SPAN><SPAN style="FONT-VARIANT: small-caps"><A class=txt2html style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(34,102,34) 1px dotted; COLOR: rgb(34,102,34); PADDING-BOTTOM: 0px" href="https://www.postgresql.org/docs/current/transaction-iso.html#XACT-SERIALIZABLE">serializable isolation</A></SPAN><SPAN>&nbsp;</SPAN>level. It has the same fixed snapshot during the transaction block, but it also checks for row changes that would be impossible if the transactions were executed serially, meaning non-concurrently. If such a changes are detected, one of the transactions is aborted. Applications that do proper row locking with<SPAN>&nbsp;</SPAN><SPAN style="FONT-VARIANT: small-caps">FOR UPDATE</SPAN><SPAN>&nbsp;</SPAN>and<SPAN>&nbsp;</SPAN><SPAN style="FONT-VARIANT: small-caps">FOR SHARE</SPAN><SPAN>&nbsp;</SPAN>probably don't need to use this mode, but it is helpful for applications that prefer to retry transactions rather than guarantee proper locking behavior.</P>
<P style="FONT-SIZE: medium; FONT-FAMILY: Georgia, Cambria, serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(16,16,16); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(249,249,249); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">As you can see, there is a lot more functionality available beyond the default<SPAN>&nbsp;</SPAN><SPAN style="FONT-VARIANT: small-caps">read committed</SPAN><SPAN>&nbsp;</SPAN>isolation level, either for read-only transactions or applications that need improper lock avoidance. You might not need these other two isolations levels in your first Postgres application, but they can come in handy.
<P style="FONT-SIZE: medium; FONT-FAMILY: Georgia, Cambria, serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(16,16,16); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(249,249,249); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">&nbsp;
<P style="FONT-SIZE: medium; FONT-FAMILY: Georgia, Cambria, serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(16,16,16); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(249,249,249); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial"><A href="https://momjian.us/main/blogs/pgblog/2023.html">https://momjian.us/main/blogs/pgblog/2023.html</A>