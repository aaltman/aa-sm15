<b> : </b>Java code</H4><SPAN class=mw-editsection style="FONT-SIZE: small; FONT-FAMILY: sans-serif; VERTICAL-ALIGN: baseline; FONT-WEIGHT: normal; MARGIN-LEFT: 1em; LINE-HEIGHT: 0; MARGIN-RIGHT: 0px; user-select: none"><SPAN class=mw-editsection-bracket style="COLOR: ; MARGIN-RIGHT: 0.25em">[</SPAN><A title="Edit section: Java code" style="TEXT-DECORATION: none; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: nowrap; COLOR: ; border-radius: 2px; overflow-wrap: break-word" href="https://en.wikipedia.org/w/index.php?title=Lamport%27s_bakery_algorithm&amp;action=edit&amp;section=10"><SPAN>edit</SPAN></A><SPAN class=mw-editsection-bracket style="COLOR: ; MARGIN-LEFT: 0.25em">]</SPAN></SPAN></DIV>
<P style="FONT-SIZE: 16px; FONT-FAMILY: sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(32,33,34); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; MARGIN: 0.5em 0px 1em; LETTER-SPACING: normal; BACKGROUND-COLOR: rgb(255,255,255); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial">We use the AtomicIntegerArray class not for its built in atomic operations but because its get and set methods work like volatile reads and writes. Under the<SPAN>&nbsp;</SPAN><A title="Java Memory Model" class=mw-redirect style="TEXT-DECORATION: none; BACKGROUND: none transparent scroll repeat 0% 0%; COLOR: ; border-radius: 2px; overflow-wrap: break-word" href="https://en.wikipedia.org/wiki/Java_Memory_Model">Java Memory Model</A><SPAN>&nbsp;</SPAN>this ensures that writes are immediately visible to all threads.</P>
<DIV class="mw-highlight mw-highlight-lang-java mw-content-ltr mw-highlight-lines" style="FONT-SIZE: 16px; FONT-FAMILY: sans-serif; BACKGROUND: rgb(248,248,248); unicode-bidi: embed; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial" dir=ltr><PRE style="BORDER-TOP: 1px solid; FONT-FAMILY: monospace, monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-X: hidden; BORDER-BOTTOM: 1px solid; POSITION: relative; COLOR: rgb(51,51,51); PADDING-BOTTOM: 1em; PADDING-TOP: 1em; PADDING-LEFT: 3.5em; BORDER-LEFT: 1px solid; LINE-HEIGHT: 1.3; PADDING-RIGHT: 1em; BACKGROUND-COLOR: rgb(248,248,248); overflow-wrap: break-word; tab-size: 4; box-shadow: rgb(240, 240, 240) 2.75em 0px 0px inset"><SPAN></SPAN><SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="1"></SPAN><SPAN class=n>AtomicIntegerArray</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>ticket</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">new</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>AtomicIntegerArray</SPAN><SPAN class=p>(</SPAN><SPAN class=n>threads</SPAN><SPAN class=p>);</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=c1 style="COLOR: rgb(61,123,123); FONT-STYLE: italic">// ticket for threads in line, n - number of threads</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="2"></SPAN><SPAN class=c1 style="COLOR: rgb(61,123,123); FONT-STYLE: italic">// Java initializes each element of 'ticket' to 0</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="3"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="4"></SPAN><SPAN class=n>AtomicIntegerArray</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>entering</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">new</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>AtomicIntegerArray</SPAN><SPAN class=p>(</SPAN><SPAN class=n>threads</SPAN><SPAN class=p>);</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=c1 style="COLOR: rgb(61,123,123); FONT-STYLE: italic">// 1 when thread entering in line</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="5"></SPAN><SPAN class=c1 style="COLOR: rgb(61,123,123); FONT-STYLE: italic">// Java initializes each element of 'entering' to 0</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="6"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="7"></SPAN><SPAN class=kd style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">public</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=kt style="COLOR: rgb(176,0,64)">void</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=nf style="COLOR: rgb(0,0,255)">lock</SPAN><SPAN class=p>(</SPAN><SPAN class=kt style="COLOR: rgb(176,0,64)">int</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>pid</SPAN><SPAN class=p>)</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=c1 style="COLOR: rgb(61,123,123); FONT-STYLE: italic">// thread ID</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="8"></SPAN><SPAN class=p>{</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="9"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=n>entering</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">set</SPAN><SPAN class=p>(</SPAN><SPAN class=n>pid</SPAN><SPAN class=p>,</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=mi style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>);</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="10"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=kt style="COLOR: rgb(176,0,64)">int</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>max</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=mi style="COLOR: rgb(102,102,102)">0</SPAN><SPAN class=p>;</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="11"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">for</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=p>(</SPAN><SPAN class=kt style="COLOR: rgb(176,0,64)">int</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>i</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=mi style="COLOR: rgb(102,102,102)">0</SPAN><SPAN class=p>;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>i</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">&lt;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>threads</SPAN><SPAN class=p>;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>i</SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">++</SPAN><SPAN class=p>)</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="12"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=p>{</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="13"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">        </SPAN><SPAN class=kt style="COLOR: rgb(176,0,64)">int</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>current</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>ticket</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">get</SPAN><SPAN class=p>(</SPAN><SPAN class=n>i</SPAN><SPAN class=p>);</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="14"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">        </SPAN><SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">if</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=p>(</SPAN><SPAN class=n>current</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">&gt;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>max</SPAN><SPAN class=p>)</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="15"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">        </SPAN><SPAN class=p>{</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="16"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">            </SPAN><SPAN class=n>max</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>current</SPAN><SPAN class=p>;</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="17"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">        </SPAN><SPAN class=p>}</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="18"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=p>}</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="19"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=n>ticket</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">set</SPAN><SPAN class=p>(</SPAN><SPAN class=n>pid</SPAN><SPAN class=p>,</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=mi style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">+</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>max</SPAN><SPAN class=p>);</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="20"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=n>entering</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">set</SPAN><SPAN class=p>(</SPAN><SPAN class=n>pid</SPAN><SPAN class=p>,</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=mi style="COLOR: rgb(102,102,102)">0</SPAN><SPAN class=p>);</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="21"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">for</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=p>(</SPAN><SPAN class=kt style="COLOR: rgb(176,0,64)">int</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>i</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">=</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=mi style="COLOR: rgb(102,102,102)">0</SPAN><SPAN class=p>;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>i</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">&lt;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>ticket</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">length</SPAN><SPAN class=p>();</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">++</SPAN><SPAN class=n>i</SPAN><SPAN class=p>)</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="22"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=p>{</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="23"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">        </SPAN><SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">if</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=p>(</SPAN><SPAN class=n>i</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">!=</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>pid</SPAN><SPAN class=p>)</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="24"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">        </SPAN><SPAN class=p>{</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="25"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">            </SPAN><SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">while</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=p>(</SPAN><SPAN class=n>entering</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">get</SPAN><SPAN class=p>(</SPAN><SPAN class=n>i</SPAN><SPAN class=p>)</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">==</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=mi style="COLOR: rgb(102,102,102)">1</SPAN><SPAN class=p>)</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=p>{</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>Thread</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">yield</SPAN><SPAN class=p>();</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=p>}</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=c1 style="COLOR: rgb(61,123,123); FONT-STYLE: italic">// wait while other thread picks a ticket</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="26"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">            </SPAN><SPAN class=k style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">while</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=p>(</SPAN><SPAN class=n>ticket</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">get</SPAN><SPAN class=p>(</SPAN><SPAN class=n>i</SPAN><SPAN class=p>)</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">!=</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=mi style="COLOR: rgb(102,102,102)">0</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">&amp;&amp;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=p>(</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>ticket</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">get</SPAN><SPAN class=p>(</SPAN><SPAN class=n>i</SPAN><SPAN class=p>)</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">&lt;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>ticket</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">get</SPAN><SPAN class=p>(</SPAN><SPAN class=n>pid</SPAN><SPAN class=p>)</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">||</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="27"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">                    </SPAN><SPAN class=p>(</SPAN><SPAN class=n>ticket</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">get</SPAN><SPAN class=p>(</SPAN><SPAN class=n>i</SPAN><SPAN class=p>)</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">==</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>ticket</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">get</SPAN><SPAN class=p>(</SPAN><SPAN class=n>pid</SPAN><SPAN class=p>)</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">&amp;&amp;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>i</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=o style="COLOR: rgb(102,102,102)">&lt;</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>pid</SPAN><SPAN class=p>)))</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="28"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">            </SPAN><SPAN class=p>{</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>Thread</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">yield</SPAN><SPAN class=p>();</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=p>}</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="29"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">        </SPAN><SPAN class=p>}</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="30"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=p>}</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="31"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=c1 style="COLOR: rgb(61,123,123); FONT-STYLE: italic">// The critical section goes here...</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="32"></SPAN><SPAN class=p>}</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="33"></SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="34"></SPAN><SPAN class=kd style="FONT-WEIGHT: bold; COLOR: rgb(0,128,0)">public</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=kt style="COLOR: rgb(176,0,64)">void</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=nf style="COLOR: rgb(0,0,255)">unlock</SPAN><SPAN class=p>(</SPAN><SPAN class=kt style="COLOR: rgb(176,0,64)">int</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=n>pid</SPAN><SPAN class=p>)</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="35"></SPAN><SPAN class=p>{</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="36"></SPAN><SPAN class=w style="COLOR: rgb(187,187,187)">    </SPAN><SPAN class=n>ticket</SPAN><SPAN class=p>.</SPAN><SPAN class=na style="COLOR: rgb(104,120,34)">set</SPAN><SPAN class=p>(</SPAN><SPAN class=n>pid</SPAN><SPAN class=p>,</SPAN><SPAN class=w style="COLOR: rgb(187,187,187)"> </SPAN><SPAN class=mi style="COLOR: rgb(102,102,102)">0</SPAN><SPAN class=p>);</SPAN>
<SPAN class=linenos style="BOX-SIZING: border-box; WIDTH: 2.75em; BACKGROUND: none transparent scroll repeat 0% 0%; WHITE-SPACE: pre; POSITION: absolute; COLOR: rgb(114,119,125); TEXT-ALIGN: right; PADDING-LEFT: 5px; LEFT: 0px; PADDING-RIGHT: 5px; MARGIN-RIGHT: 4px" data-line="37"></SPAN><SPAN class=p>}</SPAN></PRE></DIV>